import{u as B,a as x,b as z,j as e,H,r as k}from"./app-C4SmtXzs.js";import{D as W,B as R,c as G,P as V,U as Y}from"./DashboardLayout-CMBsVX61.js";import{C as j,b as y,c as v,a as N}from"./card-CGBAZfCO.js";import{B as u}from"./button-CPi2Vosb.js";import{I as d}from"./input-qDfbrajX.js";import{s as p}from"./use-toast-B9HC7Yw7.js";import{c as _,a as U,b as $}from"./customersData-48ZDDR8v.js";import{A as q}from"./arrow-left-vgf7Q5lf.js";import{U as w,F as J}from"./user-BFbh6T51.js";import{P as K}from"./phone-BNjyhZNU.js";import{S as T}from"./star-BrX2yoFz.js";import{T as Q}from"./trash-2-BFFXdZS-.js";import{M as X}from"./mail-ZHQO5KUs.js";import{M as Z}from"./map-pin-BGfRqu9a.js";import{I as ee}from"./image-DkdGy7dK.js";import{U as D}from"./upload-hBGJxNAI.js";import{T as ae}from"./triangle-alert-BuVdEArW.js";import{S as re}from"./save-uAZOBswd.js";/* empty css            */import"./eye-pcZE0Q26.js";function Ce(){const{flash:h}=B().props,[n,b]=x.useState([]),[P,L]=x.useState(!1),[c,i]=x.useState({});x.useEffect(()=>{h?.success&&p.success("نجح",h.success),h?.error&&p.error("خطأ",h.error)},[h]);const{data:r,setData:t,post:F,processing:f,errors:g}=z({name:"",email:"",phone:"",phones:[],address:"",nationality:"",customerType:"INDIVIDUAL",idNumber:"",commercialRecord:"",status:"ACTIVE",guarantorName:"",guarantorPhone:"",guarantorId:"",guarantorData:{name:"",phone:"",idNumber:"",nationality:"",address:"",relationship:"",workPlace:"",workPhone:""},notes:"",warnings:"",rating:"",idCardCopy:null,guarantorIdCardCopy:null,commercialRecordCopy:null}),S=()=>{if(n.length<3){const a={number:"",type:"MOBILE",label:"",isPrimary:n.length===0},s=[...n,a];b(s),t("phones",s)}},A=a=>{const s=n.filter((l,o)=>o!==a);b(s),t("phones",s)},E=a=>{const s=n.map((l,o)=>({...l,isPrimary:o===a}));b(s),t("phones",s)},C=(a,s,l)=>{const o=n.map((I,M)=>M===a?{...I,[s]:l}:I);b(o),t("phones",o)},m=(a,s)=>{a==="idCardCopy"?(t("idCardCopy",s),s&&s.type.startsWith("image/")?i(l=>({...l,idCardCopy:URL.createObjectURL(s)})):i(l=>{const o={...l};return delete o.idCardCopy,o})):a==="guarantorIdCardCopy"?(t("guarantorIdCardCopy",s),s&&s.type.startsWith("image/")?i(l=>({...l,guarantorIdCardCopy:URL.createObjectURL(s)})):i(l=>{const o={...l};return delete o.guarantorIdCardCopy,o})):a==="commercialRecordCopy"&&(t("commercialRecordCopy",s),s&&s.type.startsWith("image/")?i(l=>({...l,commercialRecordCopy:URL.createObjectURL(s)})):i(l=>{const o={...l};return delete o.commercialRecordCopy,o}))},O=a=>{a.preventDefault(),F("/customers",{forceFormData:!0,onSuccess:()=>{p.success("تم الإنشاء بنجاح","تم إنشاء العميل بنجاح"),k.visit("/customers")},onError:s=>{s.message?p.error("خطأ في الإنشاء",s.message):p.error("خطأ في الإنشاء","يرجى التحقق من البيانات المدخلة")}})};return x.useEffect(()=>{const a=!!(r.nationality&&r.nationality!=="عماني"&&r.customerType==="INDIVIDUAL");L(a)},[r.nationality,r.customerType]),x.useEffect(()=>()=>{Object.values(c).forEach(a=>{a&&URL.revokeObjectURL(a)})},[c]),e.jsxs(W,{children:[e.jsx(H,{title:"إضافة عميل جديد"}),e.jsxs("div",{className:"space-y-6 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>k.visit("/customers"),children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(w,{className:"h-6 w-6"}),"إضافة عميل جديد"]})})]})}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"المعلومات الأساسية"]})}),e.jsx(N,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["اسم العميل ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"text",value:r.name,onChange:a=>t("name",a.target.value),placeholder:"أدخل اسم العميل",className:g.name?"border-red-500":""}),g.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["نوع العميل ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex gap-2",children:_.map(a=>e.jsxs("button",{type:"button",onClick:()=>t("customerType",a.value),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${r.customerType===a.value?"bg-primary text-white border-primary":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[a.value==="COMPANY"?e.jsx(R,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"}),a.label]},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"رقم الهوية"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{type:"text",value:r.idNumber,onChange:a=>t("idNumber",a.target.value),className:"pr-10",placeholder:"أدخل رقم الهوية"})]})]}),r.customerType==="COMPANY"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"السجل التجاري"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{type:"text",value:r.commercialRecord,onChange:a=>t("commercialRecord",a.target.value),className:"pr-10",placeholder:"أدخل السجل التجاري"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"الجنسية"}),e.jsxs("select",{value:r.nationality,onChange:a=>t("nationality",a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر الجنسية"}),U.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"رقم الهاتف الرئيسي"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{type:"tel",value:r.phone,onChange:a=>t("phone",a.target.value),className:"pr-10",placeholder:"أدخل رقم الهاتف الرئيسي"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"أرقام هواتف إضافية (اختياري)"}),n.length<3&&e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:S,className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),"إضافة رقم"]})]}),n.map((a,s)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(d,{type:"tel",value:a.number,onChange:l=>C(s,"number",l.target.value),placeholder:"رقم الهاتف"})}),e.jsx("div",{className:"w-32",children:e.jsxs("select",{value:a.type,onChange:l=>C(s,"type",l.target.value),className:"w-full px-2 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"MOBILE",children:"جوال"}),e.jsx("option",{value:"LANDLINE",children:"أرضي"}),e.jsx("option",{value:"WHATSAPP",children:"واتساب"})]})}),e.jsx("div",{className:"w-24",children:e.jsx(d,{type:"text",value:a.label,onChange:l=>C(s,"label",l.target.value),className:"text-sm",placeholder:"تسمية"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>E(s),className:`h-8 w-8 p-0 ${a.isPrimary?"bg-primary text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}`,title:"رقم رئيسي",children:e.jsx(T,{className:"h-3 w-3"})}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>A(s),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",title:"حذف",children:e.jsx(Q,{className:"h-3 w-3"})})]})]},s))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"البريد الإلكتروني"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{type:"email",value:r.email,onChange:a=>t("email",a.target.value),className:"pr-10",placeholder:"أدخل البريد الإلكتروني"})]}),g.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g.email})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"العنوان"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute right-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("textarea",{value:r.address,onChange:a=>t("address",a.target.value),rows:3,className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"أدخل العنوان الكامل"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"حالة العميل"}),e.jsx("select",{value:r.status,onChange:a=>t("status",a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white",children:$.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"التقييم"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("select",{value:r.rating,onChange:a=>t("rating",a.target.value),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر التقييم"}),e.jsx("option",{value:"1",children:"1 - ضعيف"}),e.jsx("option",{value:"2",children:"2 - مقبول"}),e.jsx("option",{value:"3",children:"3 - جيد"}),e.jsx("option",{value:"4",children:"4 - جيد جداً"}),e.jsx("option",{value:"5",children:"5 - ممتاز"})]})]})]})]})})]}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"معلومات الضامن ",P?"(مطلوب للعملاء غير العمانيين)":"(اختياري)"]})}),e.jsx(N,{children:P?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["اسم الضامن ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"text",value:r.guarantorData.name,onChange:a=>t("guarantorData",{...r.guarantorData,name:a.target.value}),placeholder:"أدخل اسم الضامن"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["هاتف الضامن ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"tel",value:r.guarantorData.phone,onChange:a=>t("guarantorData",{...r.guarantorData,phone:a.target.value}),placeholder:"أدخل هاتف الضامن"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["رقم هوية الضامن ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"text",value:r.guarantorData.idNumber,onChange:a=>t("guarantorData",{...r.guarantorData,idNumber:a.target.value}),placeholder:"أدخل رقم هوية الضامن"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["جنسية الضامن ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.guarantorData.nationality,onChange:a=>t("guarantorData",{...r.guarantorData,nationality:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر جنسية الضامن"}),U.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["صلة القرابة ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{type:"text",value:r.guarantorData.relationship,onChange:a=>t("guarantorData",{...r.guarantorData,relationship:a.target.value}),placeholder:"مثل: أخ، أب، صديق"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"مكان العمل"}),e.jsx(d,{type:"text",value:r.guarantorData.workPlace,onChange:a=>t("guarantorData",{...r.guarantorData,workPlace:a.target.value}),placeholder:"أدخل مكان العمل"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["عنوان الضامن ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:r.guarantorData.address,onChange:a=>t("guarantorData",{...r.guarantorData,address:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"أدخل عنوان الضامن الكامل"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"اسم الضامن"}),e.jsx(d,{type:"text",value:r.guarantorName,onChange:a=>t("guarantorName",a.target.value),placeholder:"أدخل اسم الضامن"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"هاتف الضامن"}),e.jsx(d,{type:"tel",value:r.guarantorPhone,onChange:a=>t("guarantorPhone",a.target.value),placeholder:"أدخل هاتف الضامن"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"رقم هوية الضامن"}),e.jsx(d,{type:"text",value:r.guarantorId,onChange:a=>t("guarantorId",a.target.value),placeholder:"أدخل رقم هوية الضامن"})]})]})})]}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"المرفقات"]})}),e.jsx(N,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"نسخة البطاقة الشخصية للعميل"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:c.idCardCopy?e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:c.idCardCopy,alt:"معاينة البطاقة الشخصية",className:"max-w-full h-32 object-contain mx-auto rounded border"}),e.jsx("button",{type:"button",onClick:()=>m("idCardCopy",null),className:"text-sm text-red-600 hover:text-red-700",children:"إزالة الصورة"})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"hidden",id:"customer-id-card",onChange:a=>m("idCardCopy",a.target.files?.[0]||null)}),e.jsx("label",{htmlFor:"customer-id-card",className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-primary",children:"اضغط لرفع نسخة البطاقة الشخصية (PDF أو صورة)"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"نسخة بطاقة الضامن الشخصية"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:c.guarantorIdCardCopy?e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:c.guarantorIdCardCopy,alt:"معاينة بطاقة الضامن",className:"max-w-full h-32 object-contain mx-auto rounded border"}),e.jsx("button",{type:"button",onClick:()=>m("guarantorIdCardCopy",null),className:"text-sm text-red-600 hover:text-red-700",children:"إزالة الصورة"})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"hidden",id:"guarantor-id-card",onChange:a=>m("guarantorIdCardCopy",a.target.files?.[0]||null)}),e.jsx("label",{htmlFor:"guarantor-id-card",className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-primary",children:"اضغط لرفع نسخة بطاقة الضامن (PDF أو صورة)"})]})})]}),r.customerType==="COMPANY"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"نسخة السجل التجاري"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:c.commercialRecordCopy?e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:c.commercialRecordCopy,alt:"معاينة السجل التجاري",className:"max-w-full h-32 object-contain mx-auto rounded border"}),e.jsx("button",{type:"button",onClick:()=>m("commercialRecordCopy",null),className:"text-sm text-red-600 hover:text-red-700",children:"إزالة الصورة"})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"hidden",id:"commercial-record",onChange:a=>m("commercialRecordCopy",a.target.files?.[0]||null)}),e.jsx("label",{htmlFor:"commercial-record",className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-primary",children:"اضغط لرفع نسخة السجل التجاري (PDF أو صورة)"})]})})]})]})})]}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"الملاحظات والتحذيرات"]})}),e.jsx(N,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ملاحظات عامة"}),e.jsx("textarea",{value:r.notes,onChange:a=>t("notes",a.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"أدخل أي ملاحظات عامة عن العميل"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-red-500"}),"تحذيرات خاصة"]}),e.jsx("textarea",{value:r.warnings,onChange:a=>t("warnings",a.target.value),rows:4,className:"w-full px-3 py-2 border border-red-300 dark:border-red-700 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"أدخل أي تحذيرات خاصة عن العميل"})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>k.visit("/customers"),disabled:f,children:"إلغاء"}),e.jsxs(u,{type:"submit",disabled:f,className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),f?"جاري الحفظ...":"إضافة العميل"]})]})]})]})]})}export{Ce as default};
