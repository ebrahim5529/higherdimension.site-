import{j as e,r as p,R as Oe,u as Ee,b as Le,a as le,H as Be}from"./app-DC70pVjm.js";import{P as re,X as me,D as Ve}from"./DashboardLayout-hjp-9ivh.js";import{C as ne}from"./card-DdBhtchT.js";import{B as k,c as V}from"./button-CCsAHJj1.js";import{I as f}from"./input-DMs8wDeE.js";import{S as We,M as z}from"./ScaffoldSelector-6KD_zRYq.js";import{T as xe}from"./trash-2-C7a61DKz.js";import{D as he,a as ue}from"./dialog-H5IOmJE1.js";import{s as D}from"./use-toast-weOckxar.js";import{F as be}from"./file-text-j4Qn0fru.js";import{P as Qe}from"./phone-CPrvSu9p.js";import{E as ze}from"./eye-DDqfhxOU.js";import{D as He}from"./download-BLwmAVtj.js";import{C as pe}from"./copy-CkyDoGKi.js";import{S as Ge}from"./send-B9hy0KfO.js";import{P as Xe}from"./printer-DLGx3_9B.js";import{A as Ye}from"./AddressSelector-BDGVl6o-.js";import{S as Je}from"./save-B12NfqSq.js";import{A as Ke}from"./arrow-left-BmnbGyLr.js";/* empty css            */import"./createLucideIcon-gXsaNq4V.js";import"./triangle-alert-Dwooo7My.js";import"./shield-5CH0y752.js";import"./circle-alert-CnKodfJj.js";import"./map-pin-BBAWf8o9.js";import"./mail-BERZcaE2.js";import"./combobox-DoqABOFG.js";import"./index-CVs4sib2.js";import"./check-DbVipb-K.js";import"./label-vs7EW7ob.js";import"./textarea-ClIJoe0M.js";const ae=({value:o,onValueChange:l,convertedErrors:a,...m})=>{const[g,r]=p.useState(o!=null?o.toString():"");p.useEffect(()=>{const s=parseFloat(g);(isNaN(s)?o!==0:s!==o)&&r(o!=null?o.toString():"")},[o]);const i=s=>{const n=V(s.target.value);if(r(n),n===""||n==="."){l(0);return}const x=parseFloat(n);!isNaN(x)&&isFinite(x)&&l(x)};return e.jsx(f,{...m,value:g,onChange:i})};function Ze({rentals:o,onAddRentalItem:l,onDeleteRentalItem:a,onUpdateRentalDetail:m,onScaffoldChange:g,errors:r={}}){return e.jsxs(ne,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"تفاصيل الإيجار"}),e.jsxs(k,{type:"button",onClick:l,className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"إضافة معدة"]})]}),e.jsxs("div",{className:"space-y-6",children:[r.rental_details&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",children:r.rental_details}),o.map((i,s)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["المعدة ",s+1]}),e.jsx("button",{type:"button",onClick:()=>a(i.id),className:"text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded-lg transition-colors",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المعدة *"}),e.jsx(We,{value:i.scaffoldId,onChange:n=>g(i.id,n),disabled:!1}),r[`rental_details.${s}.scaffold_id`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.scaffold_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"تاريخ بداية الإيجار *"}),e.jsx(f,{type:"date",value:i.startDate,onChange:n=>m(i.id,"startDate",n.target.value),className:`w-full bg-white ${r[`rental_details.${s}.start_date`]?"border-red-500":""}`,dir:"ltr",lang:"en",required:!0}),r[`rental_details.${s}.start_date`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.start_date`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة *"}),e.jsxs("select",{value:i.durationType,onChange:n=>m(i.id,"durationType",n.target.value),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent bg-white ${r[`rental_details.${s}.duration_type`]?"border-red-500":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"monthly",children:"شهري"}),e.jsx("option",{value:"daily",children:"يومي"})]}),r[`rental_details.${s}.duration_type`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.duration_type`]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[i.durationType==="monthly"?"اختر عدد الأشهر":"اختر عدد الأيام"," *"]}),e.jsx(f,{type:"text",value:i.duration,onChange:n=>{const x=V(n.target.value);n.target.value=x;const d=x===""?0:Number(x)||0;m(i.id,"duration",d)},placeholder:i.durationType==="monthly"?"بالأشهر":"بالأيام",dir:"ltr",lang:"en",required:!0,className:`bg-white ${r[`rental_details.${s}.duration`]?"border-red-500":""}`}),r[`rental_details.${s}.duration`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.duration`]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.durationType==="monthly"?"(1 شهر = 30 يوم)":"حساب يومي"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["الكمية ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{type:"text",value:i.quantity||"",onChange:n=>{const x=V(n.target.value);n.target.value=x;const d=x===""?0:Number(x)||0;!isNaN(d)&&d>=0&&m(i.id,"quantity",d)},dir:"ltr",lang:"en",required:!0,className:`bg-white ${r[`rental_details.${s}.quantity`]?"border-red-500":""}`,placeholder:"أدخل الكمية"}),r[`rental_details.${s}.quantity`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.quantity`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"الإيجار اليومي (ر.ع)"}),e.jsx(ae,{value:i.dailyRate,onValueChange:n=>m(i.id,"dailyRate",n),dir:"ltr",lang:"en",className:`bg-white ${r[`rental_details.${s}.daily_rate`]?"border-red-500":""}`,placeholder:"0.00"}),r[`rental_details.${s}.daily_rate`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.daily_rate`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"الإيجار الشهري (ر.ع)"}),e.jsx(ae,{value:i.monthlyRate,onValueChange:n=>m(i.id,"monthlyRate",n),dir:"ltr",lang:"en",className:`bg-white ${r[`rental_details.${s}.monthly_rate`]?"border-red-500":""}`,placeholder:"0.00"}),r[`rental_details.${s}.monthly_rate`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.monthly_rate`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"الخصم (ر.ع)"}),e.jsx(ae,{value:i.discount,onValueChange:n=>m(i.id,"discount",n),dir:"ltr",lang:"en",className:`bg-white ${r[`rental_details.${s}.discount`]?"border-red-500":""}`,placeholder:"0.00"}),r[`rental_details.${s}.discount`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.discount`]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"خصم على هذه المعدة فقط"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"تاريخ النهاية"}),e.jsx(f,{type:"date",value:i.endDate||"",className:"w-full bg-gray-100",dir:"ltr",lang:"en",readOnly:!0,placeholder:i.endDate?"":"سيتم حسابه تلقائياً"}),r[`rental_details.${s}.end_date`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`rental_details.${s}.end_date`]})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"الإجمالي (ر.ع)"}),e.jsx(f,{type:"text",value:i.total.toFixed(2),className:"w-full bg-gray-100 font-bold text-[#58d2c8]",dir:"ltr",lang:"en",readOnly:!0})]})]})]},i.id))]})]})}function Ue({payments:o,onAddPayment:l,onDeletePayment:a,onUpdatePayment:m,onCheckImageChange:g,errors:r={}}){const i=o.reduce((s,n)=>s+n.amount,0);return e.jsxs("div",{className:"card p-6 mb-6",style:{padding:0},children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"المدفوعات"}),e.jsxs(k,{type:"button",onClick:l,className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"إضافة دفعة"]})]}),e.jsx("div",{className:"space-y-4",children:o.map((s,n)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold",children:["الدفعة ",n+1]}),e.jsx("button",{type:"button",onClick:()=>a(s.id),className:"text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded-lg transition-colors",children:e.jsx(xe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"طريقة الدفع *"}),e.jsxs("select",{value:s.paymentMethod,onChange:x=>m(s.id,"paymentMethod",x.target.value),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent bg-white ${r[`payments.${n}.payment_method`]?"border-red-500":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"cash",children:"نقداً"}),e.jsx("option",{value:"check",children:"شيكات"}),e.jsx("option",{value:"credit_card",children:"بطاقة ائتمان"}),e.jsx("option",{value:"bank_transfer",children:"تحويل بنكي"})]}),r[`payments.${n}.payment_method`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`payments.${n}.payment_method`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"تاريخ الدفع *"}),e.jsx(f,{type:"date",value:s.paymentDate,onChange:x=>m(s.id,"paymentDate",x.target.value),className:`w-full bg-white ${r[`payments.${n}.payment_date`]?"border-red-500":""}`,dir:"ltr",lang:"en",required:!0}),r[`payments.${n}.payment_date`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`payments.${n}.payment_date`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المبلغ (ر.ع) *"}),e.jsx(f,{type:"text",value:s.amount,onChange:x=>{const d=V(x.target.value);x.target.value=d;const h=d===""?0:Number(d)||0;m(s.id,"amount",h)},dir:"ltr",lang:"en",required:!0,className:`bg-white ${r[`payments.${n}.amount`]?"border-red-500":""}`,placeholder:"0"}),r[`payments.${n}.amount`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`payments.${n}.amount`]})]})]}),s.paymentMethod==="check"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رقم الشيك"}),e.jsx(f,{type:"text",value:s.checkNumber||"",onChange:x=>m(s.id,"checkNumber",x.target.value),placeholder:"أدخل رقم الشيك",dir:"ltr",lang:"en",className:`bg-white ${r[`payments.${n}.check_number`]?"border-red-500":""}`}),r[`payments.${n}.check_number`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`payments.${n}.check_number`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"البنك"}),e.jsxs("select",{value:s.bankName||"",onChange:x=>m(s.id,"bankName",x.target.value),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent bg-white ${r[`payments.${n}.bank_name`]?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"اختر البنك"}),e.jsx("option",{value:"بنك مسقط",children:"بنك مسقط"}),e.jsx("option",{value:"البنك الوطني العماني",children:"البنك الوطني العماني"}),e.jsx("option",{value:"بنك عمان العربي",children:"بنك عمان العربي"}),e.jsx("option",{value:"بنك الإمارات دبي الوطني",children:"بنك الإمارات دبي الوطني"}),e.jsx("option",{value:"بنك HSBC عمان",children:"بنك HSBC عمان"}),e.jsx("option",{value:"بنك ستاندرد تشارترد",children:"بنك ستاندرد تشارترد"}),e.jsx("option",{value:"بنك المشرق",children:"بنك المشرق"}),e.jsx("option",{value:"بنك أبوظبي الإسلامي",children:"بنك أبوظبي الإسلامي"})]}),r[`payments.${n}.bank_name`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`payments.${n}.bank_name`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"تاريخ الشيك"}),e.jsx(f,{type:"date",value:s.checkDate||"",onChange:x=>m(s.id,"checkDate",x.target.value),className:`w-full bg-white ${r[`payments.${n}.check_date`]?"border-red-500":""}`,dir:"ltr",lang:"en"}),r[`payments.${n}.check_date`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:r[`payments.${n}.check_date`]})]})]}),e.jsxs("div",{className:"md:col-span-3 mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"صورة الشيك"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{accept:"image/*",className:"hidden",id:`check-image-${s.id}`,type:"file",onChange:x=>{const d=x.target.files?.[0]||null;d&&g(s.id,d)}}),e.jsxs("label",{htmlFor:`check-image-${s.id}`,className:"cursor-pointer bg-[#58d2c8] text-white px-4 py-2 rounded-lg hover:bg-[#4AB8B3] transition-colors flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"رفع صورة الشيك"]}),s.checkImage&&e.jsx("span",{className:"text-sm text-gray-600",children:s.checkImage.name}),s.checkImagePath&&!s.checkImage&&e.jsx("span",{className:"text-sm text-gray-600",children:"صورة موجودة"})]})})]})]},s.id))}),e.jsx("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200 mt-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"إجمالي المدفوعات:"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:[i.toFixed(2)," ر.ع"]})]})})]})}const ge=({open:o,onOpenChange:l,contract:a,customerPhone:m=""})=>{const[g,r]=p.useState(m),[i,s]=p.useState(""),[n,x]=p.useState("");p.useEffect(()=>{a&&o&&(r(m),d())},[a,o,m]),p.useEffect(()=>{i.trim()?x(i):d()},[i,a]);const d=()=>{if(!a)return;const _=a.contract_type||"تأجير معدات بناء",y=typeof window<"u"?window.location.origin:"",T=a.contract_number||"",q=`${y}/contract/sign/${T}`,L=`السلام عليكم ورحمة الله وبركاته



أهلاً وسهلاً بكم في شركة البعد العالي للتجارة



تم إعداد عقد إيجار معدات بناء برقم: *${T}*



تفاصيل العقد:

• العميل: ${a.customer_name}

• القيمة الإجمالية: ${a.total_amount} ر.ع

• تاريخ العقد: ${a.contract_date}

• نوع العقد: ${_}



يرجى مراجعة العقد والتوقيع عليه من خلال الرابط التالي:

${q}



بعد التوقيع سيتم إرسال نسخة موقعة إليكم



شكراً لثقتكم بنا
شركة البعد العالي للتجارة`;x(L)},h=_=>{let y=_.replace(/[\s\-\(\)]/g,"");return y.startsWith("+968")?y=y.substring(4):y.startsWith("968")&&(y=y.substring(3)),`968${y}`},u=()=>{navigator.clipboard.writeText(n),D.success("تم النسخ","تم نسخ الرسالة إلى الحافظة")},$=()=>{if(!g.trim()){D.error("خطأ","يرجى إدخال رقم الهاتف");return}const _=h(g),y=encodeURIComponent(n),T=`https://wa.me/${_}?text=${y}`;window.open(T,"_blank")},R=()=>{if(!g.trim()){D.error("خطأ","يرجى إدخال رقم الهاتف");return}D.info("قيد التطوير","سيتم إضافة هذه الميزة قريباً")},O=()=>{a&&window.open(`/contracts/${a.id}/invoice`,"_blank")},A=()=>{a&&D.info("قيد التطوير","سيتم إضافة هذه الميزة قريباً")},E=g.trim().length>=7;return a?e.jsx(he,{open:o,onOpenChange:l,children:e.jsxs(ue,{className:"max-w-2xl max-h-[90vh] overflow-y-auto p-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(z,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"إرسال العقد عبر الواتساب"}),e.jsx("p",{className:"text-sm text-gray-600",children:"إرسال العقد للعميل للتوقيع"})]})]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>l(!1),className:"h-8 w-8",children:e.jsx(me,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(be,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"معلومات العقد"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"رقم العقد:"}),e.jsxs("span",{className:"font-medium text-gray-900 mr-2",children:[" ",a.contract_number]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"اسم العميل:"}),e.jsxs("span",{className:"font-medium text-gray-900 mr-2",children:[" ",a.customer_name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"القيمة الإجمالية:"}),e.jsxs("span",{className:"font-medium text-gray-900 mr-2",children:[" ",a.total_amount," ر.ع"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"تاريخ العقد:"}),e.jsxs("span",{className:"font-medium text-gray-900 mr-2",children:[" ",a.contract_date]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(Qe,{className:"h-4 w-4"}),"رقم الهاتف"]}),e.jsx(f,{placeholder:"96812345678 أو 12345678",type:"tel",value:g,onChange:_=>r(_.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500",children:"يمكن إدخال الرقم بدون رمز البلد أو مع +968"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(z,{className:"h-4 w-4"}),"الرسالة المخصصة (اختياري)"]}),e.jsx("textarea",{placeholder:"اكتب رسالة مخصصة أو اتركها فارغة لاستخدام الرسالة الافتراضية",rows:6,value:i,onChange:_=>s(_.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-3",children:"معاينة وتوليد العقد:"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(k,{variant:"default",onClick:O,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"معاينة نموذج العقد"]}),e.jsxs(k,{variant:"default",onClick:A,className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"توليد PDF"]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"معاينة الرسالة:"}),e.jsx("div",{className:"bg-white rounded border p-3 text-sm text-gray-700 whitespace-pre-wrap max-h-40 overflow-y-auto",children:n})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsx(k,{variant:"ghost",onClick:()=>l(!1),children:"إلغاء"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{variant:"default",onClick:u,className:"bg-gray-600 hover:bg-gray-700",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"نسخ الرسالة"]}),e.jsxs(k,{variant:"default",onClick:$,disabled:!E,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"فتح الواتساب"]}),e.jsxs(k,{variant:"default",onClick:R,disabled:!E,className:"bg-[#58d2c8] hover:bg-[#4AB8B3] disabled:bg-gray-400 disabled:cursor-not-allowed",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"إرسال عبر النظام"]})]})]})]})}):null};function et({open:o,onOpenChange:l,contractNumber:a,contractDate:m,customerName:g,customerNumber:r,deliveryAddress:i,rentalDetails:s,transportCost:n,totalDiscount:x,customerPhone:d=""}){const[h,u]=Oe.useState(!1),R=s.reduce((j,w)=>j+w.total,0)+n-x,O=j=>new Date(j).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric"}),A=j=>{if(!j)return"";try{const w=new Date(j);if(isNaN(w.getTime()))return"";const S=w.getDate(),G=w.getMonth()+1,W=w.getFullYear();return`${S}/${G}/${W}`}catch{return""}},E=j=>new Intl.NumberFormat("ar-OM",{minimumFractionDigits:3,maximumFractionDigits:3}).format(j),_=(j,w)=>w==="daily"?`${j} يوم`:`${j} شهر`,y=()=>{window.print()},T=()=>{const w=`${typeof window<"u"?window.location.origin:""}/contract/sign/${a}`,S=`السلام عليكم ورحمة الله وبركاته



أهلاً وسهلاً بكم في شركة البعد العالي للتجارة



تم إعداد عقد إيجار معدات بناء برقم: *${a}*



تفاصيل العقد:

• العميل: ${g}

• القيمة الإجمالية: ${R.toFixed(2)} ر.ع

• تاريخ العقد: ${O(m)}

• نوع العقد: تأجير معدات بناء



يرجى مراجعة العقد والتوقيع عليه من خلال الرابط التالي:

${w}



بعد التوقيع سيتم إرسال نسخة موقعة إليكم



شكراً لثقتكم بنا
شركة البعد العالي للتجارة`;navigator.clipboard.writeText(S).then(()=>{D.success("تم النسخ","تم نسخ رسالة الواتساب بنجاح")}).catch(()=>{D.error("خطأ","فشل نسخ الرسالة")})},q=()=>{u(!0)},L=O(m),B=A(m),[ee,M,H]=B.split("/");return e.jsxs(e.Fragment,{children:[e.jsxs(he,{open:o,onOpenChange:l,children:[e.jsxs(ue,{className:"max-w-5xl max-h-[95vh] overflow-y-auto p-0 bg-white rounded-lg shadow-2xl w-full no-print",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between z-10 no-print",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"عقد إيجار معدات بناء"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm",title:"طباعة العقد على ورقة A4",children:[e.jsx(Xe,{className:"h-4 w-4"}),"طباعة"]}),e.jsxs(k,{onClick:T,className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-sm bg-gray-600 hover:bg-gray-700 text-white",title:"نسخ رسالة الواتساب",children:[e.jsx(pe,{className:"h-4 w-4"}),"نسخ الرسالة"]}),e.jsxs(k,{onClick:q,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm",title:"إرسال الفاتورة عبر الواتساب",children:[e.jsx(z,{className:"h-4 w-4"}),"إرسال عبر الواتساب"]}),e.jsx("button",{onClick:()=>l(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(me,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"p-8 sm:p-12 bg-white contract-content",dir:"rtl",style:{fontFamily:"Arial, sans-serif"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-8 pb-4 border-b-2 border-black contract-header",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h2",{className:"text-2xl font-bold text-black mb-1",children:"الـبعد الـعالي للتجـارة"}),e.jsx("p",{className:"text-sm font-semibold text-black mb-3",style:{letterSpacing:"0.5px"},children:"HIGHER DIMENSION TRD"}),e.jsxs("div",{className:"space-y-1 text-sm text-black",children:[e.jsx("p",{children:"سلطنة عمان | ص.ب: 215 | الرمز البريدي: 619 | نقال: 93099914"}),e.jsx("p",{style:{direction:"ltr",textAlign:"right"},children:"Sultanate of Oman | P.O. Box: 215 | P.C: 619 | GSM: 93099914"})]})]}),e.jsx("div",{className:"text-left",children:e.jsxs("div",{className:"bg-white border-2 border-black rounded-lg px-6 py-4",children:[e.jsx("p",{className:"text-sm text-black mb-1",children:"NO:"}),e.jsx("p",{className:"text-3xl font-bold text-black",children:a})]})})]}),e.jsxs("div",{className:"text-center mb-8 contract-title",children:[e.jsx("h1",{className:"text-3xl font-bold text-black mb-2",children:"عقد إيجار معدات بناء"}),e.jsx("div",{className:"w-full h-1 bg-black mb-4"})]}),e.jsx("div",{className:"mb-6 text-base leading-relaxed text-black contract-date",children:e.jsxs("p",{children:["إنه في يوم: ",e.jsx("span",{className:"font-semibold",children:L})," الموافق"," ",e.jsx("span",{className:"font-semibold border-b border-black px-2",children:ee})," /"," ",e.jsx("span",{className:"font-semibold border-b border-black px-2",children:M})," /"," ",e.jsx("span",{className:"font-semibold border-b border-black px-2",children:H})," م، تم الإتفاق بين كل من:"]})}),e.jsxs("div",{className:"mb-6 space-y-3 contract-sections",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border-r-4 border-black",children:[e.jsx("p",{className:"text-lg font-bold mb-2 text-black",children:"الطرف الأول (المالك):"}),e.jsxs("p",{className:"text-base text-black",children:["شركة البعد العالي للتجارة، س.ت: ",e.jsx("span",{className:"font-semibold",children:"1208502"}),"، ومقرها ولاية السيب، هاتف:"," ",e.jsx("span",{className:"font-semibold",children:"٩٣٠٩٩٩١٤"}),"."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border-r-4 border-black",children:[e.jsx("p",{className:"text-lg font-bold mb-2 text-black",children:"الطرف الثاني (المستأجر):"}),e.jsxs("p",{className:"text-base mb-2 text-black",children:["شركة / مؤسسة: ",e.jsx("span",{className:"font-semibold",children:g})]}),e.jsxs("p",{className:"text-base mb-2 text-black",children:["س.ت: ",e.jsx("span",{className:"font-semibold",children:r})]}),e.jsxs("div",{className:"space-y-1 mt-2",children:[e.jsxs("p",{className:"text-base text-black",children:["ويمثلها في هذا العقد: ",e.jsx("span",{className:"inline-block border-b border-black w-64 mx-1"})," بصفته:"," ",e.jsx("span",{className:"inline-block border-b border-black w-32 mx-1"})]}),e.jsxs("p",{className:"text-base text-black",children:[e.jsx("span",{className:"inline-block border-b border-black w-64 mx-14"})," بصفته:"," ",e.jsx("span",{className:"inline-block border-b border-black w-32 mx-1"})]})]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-white border-r-4 border-black rounded contract-sections",children:[e.jsx("p",{className:"text-lg font-bold mb-2 text-black",children:"مقدمة:"}),e.jsx("p",{className:"text-base leading-relaxed text-justify text-black",children:"الطرف الأول منشأة تمتلك عدد من المعدات، وقد أبدى الطرف الثاني رغبته في استئجار عدد منها بغرض الانتفاع بها لفترة زمنية محددة، وقد اتفق الطرفان على ما يلي:"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-lg font-bold mb-4 text-black",children:"أولاً: بموجب هذا العقد التزم المالك (الطرف الأول) بتأجير عدد من المعدات للمستأجر (الطرف الثاني) والمبينة أوصافها فيما يلي:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-2 border-black contract-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white border-2 border-black",children:[e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"م"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"النوع"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"العدد"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"تاريخ الإيجار"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"تاريخ الإرجاع"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"المدة"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"قيمة الإيجار"})]})}),e.jsx("tbody",{children:s.map((j,w)=>e.jsxs("tr",{className:"border-2 border-black",children:[e.jsx("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:w+1}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:j.itemDescription||"تأجير"}),e.jsx("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:j.quantity}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:A(j.startDate)}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:A(j.endDate)}),e.jsx("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:_(j.duration,j.durationType)}),e.jsx("td",{className:"border-2 border-black p-3 text-center font-bold text-black",children:E(j.total)})]},j.id))})]})})]}),e.jsxs("div",{className:"mb-4 p-4 bg-white rounded border-r-4 border-black contract-sections",children:[e.jsx("p",{className:"text-lg mb-2 text-black",children:e.jsx("span",{className:"font-bold",children:"ثانياً: مكان الاتفاق:"})}),e.jsx("p",{className:"text-base mr-4 text-black",children:i||"ولاية السيب، سلطنة عمان"})]}),e.jsxs("div",{className:"mb-4 p-4 bg-white rounded border-r-4 border-black contract-sections",children:[e.jsx("p",{className:"text-lg mb-2 text-black",children:e.jsx("span",{className:"font-bold",children:"ثالثاً: مدة العقد:"})}),e.jsx("p",{className:"text-base leading-relaxed mr-4 text-justify text-black",children:"مدة هذا العقد تبدأ من تاريخ إستلام المستأجر للمعدات الموضحة في العقد، وتتجدد تلقائياً لفترة مماثلة بعد انقضاء مدة العقد الأصلية في حالة عدم إرجاع المعدات وعدم الإخطار، وفي هذه الحالة يحق للطرف الأول تحديد سعر إيجار جديد بعد انتهاء هذا العقد."})]}),e.jsxs("div",{className:"mb-4 p-4 bg-white rounded border-r-4 border-black contract-sections",children:[e.jsx("p",{className:"text-lg mb-3 text-black",children:e.jsx("span",{className:"font-bold",children:"رابعاً: التزامات المستأجر:"})}),e.jsxs("div",{className:"space-y-3 mr-4 text-base leading-relaxed",children:[e.jsx("p",{className:"text-justify text-black",children:"• يلتزم المستأجر بتمكين المؤجر أو من يمثله بمعاينة المعدات المؤجرة وتفقدها وصيانتها في أى وقت أو سحبها ونقلها في حال تخلف المستأجر عن سداد قيمة الإيجار مقدماً أو الإخلال بشروط العقد دون أن يتحمل أي مسئولية نتيجة الضرر الناتج عن سحب المعدات أو فكها من الموقع ويعد هذا الشرط بمثابة الإخطار المسبق للمستأجر."}),e.jsx("p",{className:"text-justify text-black",children:"• يقر المستأجر بأنه قد عاين المعدات المؤجرة معاينة نافية للجهالة وقبلها بحالتها الراهنة، وأنها صالحة للإستعمال."}),e.jsx("p",{className:"text-justify text-black",children:"• إذا تسبب المستأجر في فقد المعدة أو تلفها كلياً أو جزئياً بفعله أو بفعل الغير يلتزم بتعويض المالك بقيمتها حسب الشراء."}),e.jsx("p",{className:"text-justify text-black",children:"• جميع العقود المبرمة حول الكميات المستأجرة يتم إعادة إحتساب قيمة إيجارية أخرى في حالة إرجاع جزء منها بعقد جديد ولا ينطبق سعر الإيجار على أي إتفاق آخر خارج عن هذا العقد، ويحدد الطرف الأول (المؤجر) القيمة الإيجارية الجديدة."}),e.jsx("p",{className:"text-justify text-black",children:"• يحق للمالك تحديد قيمة إيجارية جديدة حسب رؤيته بعد إنتهاء هذا العقد أو التجديد التلقائي ويعد هذا الشرط بمثابة الإخطار المسبق للمستأجر."}),e.jsx("p",{className:"text-justify text-black",children:"• يقر الطرف الثاني (المستأجر) بتخويل أى شخص يعمل لديه باستلام المعدات وتسليمها."}),e.jsx("p",{className:"text-justify text-black",children:"• لا يعتد بأى إدعاء حول إرجاع المعدات ما لم يقدم المستأجر ما يفيد ذلك كتابياً موقعاً من طرف المؤجر."})]})]}),e.jsxs("div",{className:"mb-8 p-4 bg-white rounded border-r-4 border-black contract-sections",children:[e.jsx("p",{className:"text-lg mb-3 text-black",children:e.jsx("span",{className:"font-bold",children:"خامساً: الفصل في النزاع:"})}),e.jsx("p",{className:"text-base leading-relaxed mr-4 text-justify text-black",children:"أي نزاع قد ينشأ عن تنفيذ هذا العقد أو تفسير نصوصه إن لم يتم حسمه بالتراضي يتم الفصل فيه لدى الجهات القضائية والمحاكم المختصة بولاية السيب وفي حالة وجود بند غير واضح يفسر لصالح المؤجر ويستمر إحتساب القيمة الإيجارية لحين إرجاع المعدات."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mt-12 pt-8 border-t-2 border-black signatures",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b-2 border-black w-48 mx-auto mb-2 h-16 signature-box"})}),e.jsx("p",{className:"font-bold text-lg text-black",children:"توقيع الطرف الأول (المؤجر)"}),e.jsx("p",{className:"text-sm text-black mt-2",children:"شركة البعد العالي للتجارة"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b-2 border-black w-48 mx-auto mb-2 h-16 signature-box"})}),e.jsx("p",{className:"font-bold text-lg text-black",children:"توقيع الطرف الثاني (المستأجر)"}),e.jsx("p",{className:"text-sm text-black mt-2",children:g})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-black text-center text-sm text-black contract-footer",children:[e.jsxs("p",{className:"mb-1",children:["رقم العقد: ",e.jsx("span",{className:"font-semibold",children:a})]}),e.jsxs("p",{children:["تاريخ الإصدار: ",e.jsx("span",{className:"font-semibold",children:L})]})]})]})]}),e.jsx("style",{children:`
          @media print {
            .no-print {
              display: none !important;
            }
            body {
              margin: 0;
              padding: 0;
            }
            .contract-content {
              padding: 20px;
              background-color: white;
              color: black;
            }
          }
        `})]}),e.jsx(ge,{open:h,onOpenChange:u,contract:{id:0,contract_number:a,customer_name:g,total_amount:R,contract_date:m,contract_type:"تأجير معدات بناء"},customerPhone:d})]})}function tt(o){const{flash:l}=Ee().props,[a,m]=p.useState(""),[g,r]=p.useState(!1),[i,s]=p.useState(null),n=c=>{s(c),c?.nationality&&H(c.nationality)},[x,d]=p.useState(()=>`CON-${Date.now()}`),[h,u]=p.useState(0),[$,R]=p.useState(0),[O,A]=p.useState(!1),[E,_]=p.useState(!1),[y,T]=p.useState(""),[q,L]=p.useState({}),[B,ee]=p.useState(""),[M,H]=p.useState(""),[j,w]=p.useState(null),S=new Date().toISOString().split("T")[0],G=new Date().toISOString().split("T")[0],W=(c,t,N)=>{if(!c||!t)return"";const b=new Date(c);return N==="daily"?b.setDate(b.getDate()+t):b.setDate(b.getDate()+t*30-1),b.toISOString().split("T")[0]},je=W(G,1,"monthly"),[P,X]=p.useState([{id:Date.now().toString(),scaffoldId:void 0,scaffold:null,itemCode:"",itemDescription:"",startDate:G,endDate:je,duration:1,durationType:"monthly",quantity:1,dailyRate:0,monthlyRate:0,discount:0,total:0}]),[Q,Y]=p.useState([{id:Date.now().toString(),paymentMethod:"cash",paymentDate:new Date().toISOString().split("T")[0],amount:0}]),ce=c=>{let t;return c.durationType==="daily"?t=c.quantity*c.dailyRate*c.duration:t=c.quantity*c.monthlyRate*c.duration,t-c.discount},Ne=(c,t,N)=>{X(b=>b.map(I=>{if(I.id===c){const v={...I,[t]:N};return(t==="startDate"||t==="duration"||t==="durationType")&&(v.endDate=W(t==="startDate"?N:v.startDate,t==="duration"?N:v.duration,t==="durationType"?N:v.durationType)),(t==="quantity"||t==="dailyRate"||t==="monthlyRate"||t==="duration"||t==="durationType"||t==="discount")&&(v.total=ce(v)),v}return I}))},ye=(c,t)=>{X(N=>N.map(b=>b.id===c&&t?{...b,scaffoldId:t.id,scaffold:t,itemCode:t.scaffold_number,itemDescription:t.description_ar||t.description_en||"",dailyRate:t.daily_rental_price||0,monthlyRate:t.monthly_rental_price||0,discount:b.discount||0,total:ce({...b,dailyRate:t.daily_rental_price||0,monthlyRate:t.monthly_rental_price||0,discount:b.discount||0})}:b))},fe=()=>{const c=new Date().toISOString().split("T")[0],t={id:Date.now().toString(),scaffoldId:void 0,scaffold:null,itemCode:"",itemDescription:"",startDate:c,endDate:W(c,1,"monthly"),duration:1,durationType:"monthly",quantity:1,dailyRate:0,monthlyRate:0,discount:0,total:0};X(N=>[...N,t])},ve=c=>{X(t=>t.filter(N=>N.id!==c))},ke=()=>{Y(c=>[...c,{id:Date.now().toString(),paymentMethod:"cash",paymentDate:new Date().toISOString().split("T")[0],amount:0,checkNumber:"",bankName:"",checkDate:"",checkImage:null,checkImagePath:null}])},we=(c,t,N)=>{Y(b=>b.map(I=>{if(I.id===c){const v={...I,[t]:N};return t==="paymentMethod"&&N!=="check"&&(v.checkNumber="",v.bankName="",v.checkDate="",v.checkImage=null),v}return I}))},_e=(c,t)=>{Y(N=>N.map(b=>b.id===c?{...b,checkImage:t}:b))},Ce=c=>{Y(t=>t.filter(N=>N.id!==c))},de=P.reduce((c,t)=>c+t.total,0),te=de+h-$,De=Q.reduce((c,t)=>c+t.amount,0),Se=te-De,$e=()=>!i||!S||!x||!y||P.length===0?!1:P.every(c=>c.scaffoldId&&c.startDate&&c.duration>0&&c.quantity>0),{data:nt,setData:J,post:Ae,processing:Te,errors:Me,clearErrors:Ie}=Le({contract_number:x,contract_date:S,customer_id:i?.id||null,delivery_address:y,delivery_address_details:q,location_map_link:B,nationality:M,transport_and_installation_cost:h,total_discount:$,contract_notes:"",rental_details:P,payments:Q});p.useEffect(()=>{J("nationality",M)},[M,J]),p.useEffect(()=>{J(c=>({...c,contract_number:x,contract_date:S,customer_id:i?.id||null,delivery_address:y,delivery_address_details:q,location_map_link:B,nationality:M,transport_and_installation_cost:h,total_discount:$,rental_details:P.map(t=>({scaffold_id:t.scaffoldId||null,item_code:t.itemCode,item_description:t.itemDescription,start_date:t.startDate,end_date:t.endDate,duration:t.duration,duration_type:t.durationType,quantity:t.quantity,daily_rate:t.dailyRate,monthly_rate:t.monthlyRate,total:t.total})),payments:Q.map(t=>({payment_method:t.paymentMethod,payment_date:t.paymentDate,amount:t.amount,check_number:t.checkNumber||null,bank_name:t.bankName||null,check_date:t.checkDate||null,check_image:t.checkImage||null}))}))},[x,S,i,y,B,M,h,$,P,Q]);const qe=c=>{c.preventDefault(),Ae("/contracts",{preserveScroll:!0,onSuccess:t=>{D.success("تم الإنشاء بنجاح","تم إضافة العقد بنجاح");const b=(t.props?.flash||{}).contract||null;b&&b.contract_number&&(d(b.contract_number),w({id:b.id,contract_number:b.contract_number,customer_name:i?.name||b.customer_name||"",total_amount:b.total_amount||te,contract_date:b.contract_date||S,contract_type:b.contract_type||"تأجير معدات بناء"})),A(!0)},onError:t=>{const N={customer_id:"العميل",contract_number:"رقم العقد",contract_date:"تاريخ العقد",delivery_address:"عنوان الموقع",location_map_link:"رابط الموقع",transport_and_installation_cost:"تكلفة النقل والتركيب",total_discount:"الخصم الإجمالي",contract_notes:"ملاحظات العقد",rental_details:"تفاصيل الإيجار",scaffold_id:"المعدة",item_code:"رمز المعدة",item_description:"وصف المعدة",start_date:"تاريخ بداية الإيجار",end_date:"تاريخ نهاية الإيجار",duration:"المدة",duration_type:"نوع المدة",quantity:"الكمية",daily_rate:"السعر اليومي",monthly_rate:"السعر الشهري",total:"الإجمالي",payments:"المدفوعات",payment_method:"طريقة الدفع",payment_date:"تاريخ الدفع",amount:"المبلغ",check_number:"رقم الشيك",bank_name:"البنك",check_date:"تاريخ الشيك",check_image:"صورة الشيك"},b=C=>C.includes("field is required")||C.includes("is required")?"هذا الحقل مطلوب":C.includes("must be a valid date")||C.includes("valid date")?"يرجى إدخال تاريخ صحيح":C.includes("must be a valid number")||C.includes("must be numeric")?"يرجى إدخال رقم صحيح":C.includes("must be unique")?"هذه القيمة مستخدمة مسبقاً":C.includes("is invalid")||C.includes("invalid")?"القيمة غير صحيحة":C,v=((C,ie="")=>{const se=[];return Object.keys(C).forEach(F=>{const K=C[F],Fe=ie?`${ie}.${F}`:F;if(Array.isArray(K))K.forEach(Z=>{if(typeof Z=="string"){let oe=N[F]||F;const U=Fe.match(/^rental_details\.(\d+)\.(.+)$/);if(U){const Re=parseInt(U[1])+1;oe=`${N[U[2]]||U[2]} (المعدة رقم ${Re})`}se.push(`${oe}: ${b(Z)}`)}});else if(typeof K=="string"){let Z=N[F]||F;se.push(`${Z}: ${b(K)}`)}}),se})(t);v.length>0?D.error("خطأ في البيانات",v[0]):D.error("خطأ في البيانات","يرجى التحقق من جميع الحقول المطلوبة وإعادة المحاولة")}})},Pe=o.filter(c=>c.name?.toLowerCase().includes(a.toLowerCase())||c.phone?.includes(a)||c.customer_number?.includes(a));return{state:{customerSearchQuery:a,showCustomerDropdown:g,selectedCustomer:i,contractNumber:x,contractDate:S,rentalDetails:P,payments:Q,transportCost:h,totalDiscount:$,whatsappModalOpen:O,previewModalOpen:E,deliveryAddress:y,deliveryAddressDetails:q,locationMapLink:B,nationality:M,createdContract:j,rentalTotal:de,totalAfterDiscount:te,remainingAmount:Se,processing:Te,errors:Me,filteredCustomers:Pe,isFormValid:$e},actions:{setCustomerSearchQuery:m,setShowCustomerDropdown:r,setSelectedCustomer:n,setContractNumber:d,setTransportCost:u,setTotalDiscount:R,setWhatsappModalOpen:A,setPreviewModalOpen:_,setDeliveryAddress:T,setDeliveryAddressDetails:L,setLocationMapLink:ee,setNationality:H,setContractDate:c=>J("contract_date",c),updateRentalDetail:Ne,handleScaffoldChange:ye,handleAddRentalItem:fe,handleDeleteRentalItem:ve,handleAddPayment:ke,updatePayment:we,handleCheckImageChange:_e,handleDeletePayment:Ce,handleSubmit:qe,clearErrors:Ie}}}function st({contractDate:o,contractNumber:l,customerSearchQuery:a,showCustomerDropdown:m,filteredCustomers:g,nationality:r,deliveryAddress:i,deliveryAddressDetails:s,locationMapLink:n,processing:x,errors:d,actions:h}){return e.jsxs(ne,{className:"p-6 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4 mb-6",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"معلومات العقد الأساسية"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"تاريخ العقد *"}),e.jsx(f,{type:"date",value:o,onChange:u=>h.setContractDate(u.target.value),className:`w-full bg-white ${d.contract_date?"border-red-500":""}`,dir:"ltr",lang:"en",required:!0}),d.contract_date&&e.jsx("div",{className:"text-red-500 text-sm mt-1 font-medium",children:d.contract_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رقم العقد *"}),e.jsx(f,{type:"text",value:l,onChange:u=>h.setContractNumber(u.target.value),placeholder:"رقم العقد",className:`w-full bg-white ${d.contract_number?"border-red-500":""}`,required:!0}),d.contract_number&&e.jsx("div",{className:"text-red-500 text-sm mt-1 font-medium",children:d.contract_number})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"العميل *"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{type:"text",value:a,onChange:u=>{h.setCustomerSearchQuery(u.target.value),h.setShowCustomerDropdown(!0),u.target.value||h.setSelectedCustomer(null)},onFocus:()=>h.setShowCustomerDropdown(!0),placeholder:"ابحث عن العميل بالاسم أو الهاتف...",required:!0,className:`w-full ${d.customer_id?"border-red-500":""}`}),d.customer_id&&e.jsx("div",{className:"text-red-500 text-sm mt-1 font-medium",children:d.customer_id}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>h.setShowCustomerDropdown(!1)}),e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto z-20",children:g.length>0?g.map(u=>e.jsxs("button",{type:"button",onClick:()=>{h.setSelectedCustomer(u),h.setCustomerSearchQuery(u.name),h.setShowCustomerDropdown(!1),h.clearErrors("customer_id")},className:"w-full text-right px-4 py-3 hover:bg-[#58d2c8]/10 transition-colors border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:u.name}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[u.customer_number&&e.jsx("div",{className:"text-xs text-gray-600",children:u.customer_number}),u.phone&&e.jsx("div",{className:"text-sm text-gray-500",dir:"ltr",children:u.phone})]})]},u.id)):e.jsx("div",{className:"px-4 py-3 text-center text-gray-500",children:"لا توجد نتائج"})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"الجنسية"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{type:"text",value:r||"سيتم تحديدها تلقائياً من بيانات العميل",readOnly:!0,className:"w-full bg-gray-50 text-gray-500 cursor-not-allowed"}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"تُحدد تلقائياً من بيانات العميل المختار"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Ye,{value:s,onChange:u=>{h.setDeliveryAddressDetails(u),h.setDeliveryAddress(u.fullAddress||""),h.clearErrors("delivery_address")},label:"عنوان الموقع (موقع تنزيل المعدات)",required:!0,disabled:x,error:d.delivery_address}),d.delivery_address&&e.jsx("div",{className:"text-red-500 text-sm mt-1 font-medium",children:d.delivery_address})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط الموقع قوقل ماب"}),e.jsx(f,{type:"url",value:n,onChange:u=>h.setLocationMapLink(u.target.value),placeholder:"https://maps.google.com/...",dir:"ltr",lang:"en",className:d.location_map_link?"border-red-500":""}),d.location_map_link&&e.jsx("div",{className:"text-red-500 text-sm mt-1 font-medium",children:d.location_map_link}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اختياري - يمكنك لصق رابط الموقع من قوقل ماب"})]})]})]})}function at({transportCost:o,totalDiscount:l,totalAfterDiscount:a,actions:m}){const[g,r]=p.useState(o!=null?o.toString():""),[i,s]=p.useState(l!=null?l.toString():"");p.useEffect(()=>{const d=parseFloat(g);(isNaN(d)?o!==0:d!==o)&&r(o!=null?o.toString():"")},[o]),p.useEffect(()=>{const d=parseFloat(i);(isNaN(d)?l!==0:d!==l)&&s(l!=null?l.toString():"")},[l]);const n=d=>{const h=V(d);if(r(h),h===""||h==="."){m.setTransportCost(0);return}const u=parseFloat(h);!isNaN(u)&&isFinite(u)&&u>=0&&m.setTransportCost(u)},x=d=>{const h=V(d);if(s(h),h===""||h==="."){m.setTotalDiscount(0);return}const u=parseFloat(h);!isNaN(u)&&isFinite(u)&&u>=0&&m.setTotalDiscount(u)};return e.jsx("div",{className:"mt-6 p-6 bg-blue-50 rounded-lg border border-blue-200 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"قيمة النقل والتحميل والتنزيل (ر.ع)"}),e.jsx(f,{type:"text",value:g,onChange:d=>n(d.target.value),dir:"ltr",lang:"en",className:"bg-white",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"إجمالي الخصم (ر.ع)"}),e.jsx(f,{type:"text",value:i,onChange:d=>x(d.target.value),dir:"ltr",lang:"en",className:"bg-white",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"إجمالي العقد بعد الخصم (ر.ع)"}),e.jsx(f,{type:"text",value:a.toFixed(2),className:"w-full bg-gray-100 font-bold text-[#58d2c8] text-lg",dir:"ltr",lang:"en",readOnly:!0})]})]})})}function lt({processing:o,isValid:l,onPreview:a,onSubmit:m,selectedCustomer:g}){return e.jsxs(ne,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(k,{type:"submit",disabled:o,className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),o?"جاري الحفظ...":"تخزين بيانات العقد"]}),e.jsxs(k,{type:"button",disabled:o,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",onClick:async r=>{if(r.preventDefault(),!g){D.error("خطأ","يرجى اختيار العميل أولاً");return}m(r)},children:[e.jsx(z,{className:"h-4 w-4"}),"إرسال للعميل عبر الواتساب"]}),e.jsxs(k,{type:"button",onClick:a,disabled:o,className:"bg-purple-600 hover:bg-purple-700 text-white flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"عرض نموذج الفاتورة"]})]}),e.jsx(k,{type:"button",onClick:()=>le.visit("/contracts"),disabled:o,className:"bg-gray-500 hover:bg-gray-600 text-white",children:"إلغاء"})]}),!l&&e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"⚠️ يرجى ملء جميع الحقول المطلوبة (*) وإضافة معدة واحدة على الأقل"})})]})}function Et({customers:o}){const{state:l,actions:a}=tt(o);return e.jsxs(Ve,{children:[e.jsx(Be,{title:"إضافة عقد جديد"}),e.jsxs("div",{className:"space-y-6 pb-8 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>le.visit("/contracts"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(Ke,{className:"h-4 w-4"}),"العودة"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"استمارة عقد جديد"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"إضافة عقد تأجير جديد"})]})]})}),e.jsxs("form",{onSubmit:a.handleSubmit,children:[e.jsx(st,{contractDate:l.contractDate,contractNumber:l.contractNumber,customerSearchQuery:l.customerSearchQuery,showCustomerDropdown:l.showCustomerDropdown,filteredCustomers:l.filteredCustomers,nationality:l.nationality,deliveryAddress:l.deliveryAddress,deliveryAddressDetails:l.deliveryAddressDetails,locationMapLink:l.locationMapLink,processing:l.processing,errors:l.errors,actions:{setCustomerSearchQuery:a.setCustomerSearchQuery,setShowCustomerDropdown:a.setShowCustomerDropdown,setSelectedCustomer:a.setSelectedCustomer,setContractNumber:a.setContractNumber,setNationality:a.setNationality,setDeliveryAddress:a.setDeliveryAddress,setDeliveryAddressDetails:a.setDeliveryAddressDetails,setLocationMapLink:a.setLocationMapLink,setContractDate:a.setContractDate,clearErrors:m=>a.clearErrors(m)}}),e.jsx(Ze,{rentals:l.rentalDetails,onAddRentalItem:a.handleAddRentalItem,onDeleteRentalItem:a.handleDeleteRentalItem,onUpdateRentalDetail:a.updateRentalDetail,onScaffoldChange:a.handleScaffoldChange,errors:l.errors}),e.jsx(at,{transportCost:l.transportCost,totalDiscount:l.totalDiscount,totalAfterDiscount:l.totalAfterDiscount,actions:{setTransportCost:a.setTransportCost,setTotalDiscount:a.setTotalDiscount}}),e.jsx(Ue,{payments:l.payments,onAddPayment:a.handleAddPayment,onDeletePayment:a.handleDeletePayment,onUpdatePayment:a.updatePayment,onCheckImageChange:a.handleCheckImageChange,errors:l.errors}),e.jsx(lt,{processing:l.processing,isValid:l.isFormValid(),onPreview:()=>a.setPreviewModalOpen(!0),onSubmit:a.handleSubmit,selectedCustomer:l.selectedCustomer})]})]}),e.jsx(ge,{open:l.whatsappModalOpen,onOpenChange:m=>{a.setWhatsappModalOpen(m),m||le.visit("/contracts")},contract:l.createdContract,customerPhone:l.selectedCustomer?.phone||""}),l.selectedCustomer&&e.jsx(et,{open:l.previewModalOpen,onOpenChange:a.setPreviewModalOpen,contractNumber:l.contractNumber||"",contractDate:l.contractDate,customerName:l.selectedCustomer.name,customerNumber:l.selectedCustomer.customer_number||"",deliveryAddress:l.deliveryAddress,rentalDetails:l.rentalDetails,transportCost:l.transportCost,totalDiscount:l.totalDiscount,customerPhone:l.selectedCustomer.phone||""})]})}export{Et as default};
