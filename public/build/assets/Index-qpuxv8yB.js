import{u as Y,a as h,b as w,j as e,H as Z,L as C}from"./app-CyMgrt3T.js";import{D as I,e as k,h as D,K as U,P as ee}from"./DashboardLayout-C2BzyX_G.js";import{B as i}from"./button-BYQHTvmA.js";import{D as T,b as se,a as R,c as S,d as O,e as P,f as F}from"./dialog-Cn2O5Yzz.js";import{T as ae,a as re,b as $,c as p,d as le,e as c}from"./table-CvUhy9g9.js";import{C as g,b as u,c as f,a as b,d as te}from"./card-Ds_akk2v.js";import{C as H}from"./checkbox-D2DmREtz.js";import{s as L}from"./use-toast-C91E3Tui.js";import{I as N}from"./input-o_dNre2V.js";/* empty css            */import"./createLucideIcon-BYf3FF-E.js";import"./triangle-alert-CIcdgZcT.js";import"./file-text-DXOoDEiS.js";import"./eye-Dxsa3bX3.js";import"./user-BsMlQm9m.js";import"./index-DIpvan59.js";import"./check-npnK0bck.js";function we({users:E,allRoles:B,allPermissions:z,stats:v}){const{flash:d}=Y().props,[K,o]=h.useState(!1),[_,m]=h.useState(!1),[q,y]=h.useState(!1),[n,j]=h.useState(null),a=w({name:"",email:"",phone:"",password:"",roles:[]}),l=w({roles:[]}),t=w({permissions:[]});h.useEffect(()=>{d?.success&&(L.success("نجح",d.success),o(!1),m(!1),y(!1),l.reset(),t.reset(),a.reset()),d?.error&&L.error("خطأ",d.error)},[d]);const A=()=>{a.post("/user-roles",{onSuccess:()=>{a.reset()}})},G=s=>{const r=a.data.roles||[];r.includes(s)?a.setData("roles",r.filter(x=>x!==s)):a.setData("roles",[...r,s])},J=s=>{j(s),l.setData({roles:s.roles.map(r=>r.id)}),o(!0)},M=()=>{n&&l.put(`/user-roles/${n.id}/roles`,{onSuccess:()=>{o(!1),j(null),l.reset()}})},Q=s=>{j(s),t.setData({permissions:s.permissions.map(r=>r.id)}),m(!0)},V=()=>{n&&t.put(`/user-roles/${n.id}/permissions`,{onSuccess:()=>{m(!1),j(null),t.reset()}})},W=s=>{const r=l.data.roles||[];r.includes(s)?l.setData("roles",r.filter(x=>x!==s)):l.setData("roles",[...r,s])},X=s=>{const r=t.data.permissions||[];r.includes(s)?t.setData("permissions",r.filter(x=>x!==s)):t.setData("permissions",[...r,s])};return e.jsxs(I,{children:[e.jsx(Z,{title:"أدوار المستخدمين"}),e.jsxs("div",{className:"w-full space-y-6 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(C,{href:"/dashboard/user-roles",className:"px-4 py-2 bg-[rgb(30,64,175)] text-white rounded-lg hover:bg-[rgb(25,55,150)] transition-colors flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"أدوار المستخدمين"]}),e.jsxs(C,{href:"/dashboard/roles",className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"الأدوار"]}),e.jsxs(C,{href:"/dashboard/permission-groups",className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"مجموعات الصلاحيات"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-xl font-semibold",children:"أدوار المستخدمين"})]}),e.jsxs(T,{open:q,onOpenChange:y,children:[e.jsx(se,{asChild:!0,children:e.jsxs(i,{children:[e.jsx(ee,{className:"h-4 w-4"}),"إضافة مستخدم جديد"]})}),e.jsxs(R,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsx(O,{children:"إضافة مستخدم جديد"}),e.jsx(P,{children:"قم بإنشاء مستخدم جديد وتعيين الأدوار له"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الاسم"}),e.jsx(N,{value:a.data.name,onChange:s=>a.setData("name",s.target.value),placeholder:"اسم المستخدم"}),a.errors.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"البريد الإلكتروني"}),e.jsx(N,{type:"email",value:a.data.email,onChange:s=>a.setData("email",s.target.value),placeholder:"example@email.com"}),a.errors.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"رقم الهاتف"}),e.jsx(N,{value:a.data.phone,onChange:s=>a.setData("phone",s.target.value),placeholder:"رقم الهاتف (اختياري)"}),a.errors.phone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"كلمة المرور"}),e.jsx(N,{type:"password",value:a.data.password,onChange:s=>a.setData("password",s.target.value),placeholder:"كلمة المرور"}),a.errors.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.password})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الأدوار"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:B.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(H,{id:`create-user-role-${s.id}`,checked:a.data.roles?.includes(s.id),onCheckedChange:()=>G(s.id)}),e.jsx("label",{htmlFor:`create-user-role-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),a.errors.roles&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.roles})]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>y(!1),children:"إلغاء"}),e.jsx(i,{onClick:A,disabled:a.processing,children:a.processing?"جاري الحفظ...":"حفظ"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(g,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"إجمالي المستخدمين"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalUsers})})]}),e.jsxs(g,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"إجمالي الأدوار"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalRoles})})]}),e.jsxs(g,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"إجمالي الصلاحيات"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalPermissions})})]})]}),e.jsxs(g,{children:[e.jsxs(u,{children:[e.jsx(f,{children:"قائمة المستخدمين"}),e.jsx(te,{children:"إدارة أدوار وصلاحيات المستخدمين"})]}),e.jsx(b,{children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs($,{children:[e.jsx(p,{children:"الاسم"}),e.jsx(p,{children:"البريد الإلكتروني"}),e.jsx(p,{children:"الأدوار"}),e.jsx(p,{children:"الصلاحيات"}),e.jsx(p,{className:"text-left",children:"الإجراءات"})]})}),e.jsx(le,{children:E.length===0?e.jsx($,{children:e.jsx(c,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"لا يوجد مستخدمون"})}):E.map(s=>e.jsxs($,{children:[e.jsx(c,{className:"font-medium",children:s.name}),e.jsx(c,{children:s.email}),e.jsx(c,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.roles.length>0?s.roles.map(r=>e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 rounded",children:r.name},r.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد أدوار"})})}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions.length>0?s.permissions.slice(0,2).map(r=>e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 rounded",children:r.name},r.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد صلاحيات"}),s.permissions.length>2&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.permissions.length-2," أكثر"]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>J(s),children:[e.jsx(D,{className:"h-4 w-4"}),"أدوار"]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>Q(s),children:[e.jsx(U,{className:"h-4 w-4"}),"صلاحيات"]})]})})]},s.id))})]})})]}),e.jsx(T,{open:K,onOpenChange:o,children:e.jsxs(R,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsx(O,{children:"تعديل أدوار المستخدم"}),e.jsxs(P,{children:["قم بتعيين الأدوار للمستخدم: ",n?.name]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الأدوار"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:B.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(H,{id:`role-${s.id}`,checked:l.data.roles?.includes(s.id),onCheckedChange:()=>W(s.id)}),e.jsx("label",{htmlFor:`role-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),l.errors.roles&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.errors.roles})]})}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>o(!1),children:"إلغاء"}),e.jsx(i,{onClick:M,disabled:l.processing,children:l.processing?"جاري الحفظ...":"حفظ"})]})]})}),e.jsx(T,{open:_,onOpenChange:m,children:e.jsxs(R,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsx(O,{children:"تعديل صلاحيات المستخدم"}),e.jsxs(P,{children:["قم بتعيين الصلاحيات للمستخدم: ",n?.name]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الصلاحيات"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:z.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(H,{id:`permission-${s.id}`,checked:t.data.permissions?.includes(s.id),onCheckedChange:()=>X(s.id)}),e.jsx("label",{htmlFor:`permission-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),t.errors.permissions&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.errors.permissions})]})}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),e.jsx(i,{onClick:V,disabled:t.processing,children:t.processing?"جاري الحفظ...":"حفظ"})]})]})})]})]})}export{we as default};
