import{r as _,j as e,H as F,a as w,b as z}from"./app-DwRfcN6X.js";import{D as R,e as D,b as y,f as P,i as H,c as A,P as U}from"./DashboardLayout-BU2B3eCa.js";import{C as x,b as m,c as o,a as h}from"./card-CNdQdVo4.js";import{B as g}from"./button-DHr1rW4g.js";import{I as Y}from"./input-U_QZj2le.js";import{T as G}from"./textarea-D4OElIqd.js";import{D as X,b as q,a as J,c as K,d as Q,e as W,f as Z}from"./dialog-D3SNBPb2.js";import{s as C}from"./use-toast-xW133pbw.js";import{A as ee}from"./arrow-left--VusLmB_.js";import{B as S}from"./x-gOtp1dkx.js";import{P as se}from"./printer-DDMpheUq.js";import{D as k}from"./download-DqYq_1U8.js";import{S as te}from"./square-pen-DBi4CZX4.js";import{S as E}from"./star-DHyblLj2.js";import{T as I}from"./triangle-alert-CYfjpRdb.js";import{E as v}from"./eye-I9j4Fhu2.js";import{F as d}from"./file-text-BYPGuL12.js";import{P as T}from"./phone-CD4u5h2S.js";import{M as ae}from"./mail-F3IImK8v.js";import{M as re}from"./map-pin-D_FqHH6g.js";import{C as L}from"./circle-check-big-N2QH7t0J.js";import{C as ne}from"./circle-x-seYkMCz-.js";/* empty css            */import"./createLucideIcon-DC1RPDG7.js";import"./shield-p0e6kCYj.js";import"./circle-alert-Dd_--HKV.js";function Ie({customer:s}){const[i,u]=_.useState("overview"),N=_.useRef(null),j=t=>new Date(t).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric"}),l=t=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"OMR"}).format(t),b=t=>{switch(t){case"ACTIVE":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"INACTIVE":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"COMPLETED":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"PENDING":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},c=t=>{switch(t){case"ACTIVE":return e.jsx(L,{className:"h-4 w-4"});case"INACTIVE":return e.jsx(ne,{className:"h-4 w-4"});case"COMPLETED":return e.jsx(L,{className:"h-4 w-4"});case"PENDING":return e.jsx(A,{className:"h-4 w-4"});default:return e.jsx(A,{className:"h-4 w-4"})}},r=s.contractsSummary||{total:s.contracts?.length||0,active:s.contracts?.filter(t=>t.status==="ACTIVE").length||0,completed:s.contracts?.filter(t=>t.status==="COMPLETED").length||0,cancelled:s.contracts?.filter(t=>t.status==="CANCELLED").length||0,totalValue:s.contracts?.reduce((t,a)=>t+(a.total_value||0),0)||0},n=s.paymentsSummary||{total:s.contractPayments?.length||0,paid:s.contractPayments?.length||0,pending:0,overdue:0,totalAmount:s.contractPayments?.reduce((t,a)=>t+(a.amount||0),0)||0},p=(s.contractPayments||[]).slice().sort((t,a)=>String(a.paymentDate||"").localeCompare(String(t.paymentDate||""))),f=(s.contractPayments||[]).reduce((t,a)=>t+Number(a.amount||0),0),V=Number(r.totalValue||0),$=Math.max(0,V-f),B=()=>{window.print()};_.useEffect(()=>{if(typeof window>"u")return;const t=()=>{N.current=i,u("overview")},a=()=>{N.current&&u(N.current),N.current=null};return window.addEventListener("beforeprint",t),window.addEventListener("afterprint",a),()=>{window.removeEventListener("beforeprint",t),window.removeEventListener("afterprint",a)}},[i]);const O=()=>{alert("سيتم تصدير ملف العميل")};return e.jsxs(R,{children:[e.jsx(F,{title:`${s.name} - تفاصيل العميل`}),e.jsx("style",{children:`
        @media print {
          @page {
            size: A4;
            margin: 8mm;
          }

          body {
            margin: 0 !important;
            padding: 0 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            font-size: 11px;
          }

          header,
          aside,
          .fixed.inset-y-0.right-0.z-50,
          .fixed.inset-0.z-40 {
            display: none !important;
          }

          .no-print {
            display: none !important;
          }

          .print-only {
            display: block !important;
          }

          .customer-screen {
            display: none !important;
          }

          .print-report {
            display: block !important;
          }

          .print-container {
            margin: 0 !important;
            padding: 0 !important;
          }

          .print-container .shadow,
          .print-container .shadow-sm,
          .print-container .shadow-md,
          .print-container .shadow-lg {
            box-shadow: none !important;
          }

          .print-break {
            page-break-inside: avoid;
          }

          .print-table {
            width: 100%;
            border-collapse: collapse;
          }

          .print-table td,
          .print-table th {
            border: 1px solid #000;
            padding: 4px;
            vertical-align: top;
          }
        }

        @media screen {
          .print-only {
            display: none;
          }

          .print-report {
            display: none;
          }
        }
      `}),e.jsxs("div",{className:"space-y-6 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:[e.jsxs("div",{className:"print-report print-container",children:[e.jsx("div",{className:"border border-black rounded-md p-3 mb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-black",children:"تقرير بيانات العميل"}),e.jsx("div",{className:"text-sm text-black",children:s.name}),e.jsxs("div",{className:"text-xs text-black",children:["رقم العميل: ",s.customer_number]})]}),e.jsxs("div",{className:"text-xs text-black",children:["تاريخ الطباعة: ",new Date().toLocaleDateString("ar-SA")]})]})}),e.jsx("table",{className:"print-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"w-1/4",children:"الاسم"}),e.jsx("td",{className:"w-1/4",children:s.name}),e.jsx("th",{className:"w-1/4",children:"رقم العميل"}),e.jsx("td",{className:"w-1/4",children:s.customer_number})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"نوع العميل"}),e.jsx("td",{children:s.customer_type==="COMPANY"?"شركة":"فرد"}),e.jsx("th",{children:"الحالة"}),e.jsx("td",{children:s.status==="ACTIVE"?"نشط":"غير نشط"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"الهاتف"}),e.jsx("td",{children:s.phone||"-"}),e.jsx("th",{children:"البريد الإلكتروني"}),e.jsx("td",{children:s.email||"-"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"الجنسية"}),e.jsx("td",{children:s.nationality||"-"}),e.jsx("th",{children:"تاريخ التسجيل"}),e.jsx("td",{children:s.registration_date?j(s.registration_date):"-"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"العنوان"}),e.jsx("td",{colSpan:3,children:s.address||"-"})]}),s.customer_type==="INDIVIDUAL"?e.jsxs("tr",{children:[e.jsx("th",{children:"رقم الهوية"}),e.jsx("td",{colSpan:3,children:s.id_number||"-"})]}):e.jsxs("tr",{children:[e.jsx("th",{children:"السجل التجاري"}),e.jsx("td",{colSpan:3,children:s.commercial_record||"-"})]}),(s.guarantorData||s.guarantor_name||s.guarantor_phone||s.guarantor_id)&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{children:e.jsx("th",{className:"font-bold",colSpan:4,children:"معلومات الضامن"})}),e.jsxs("tr",{children:[e.jsx("th",{children:"اسم الضامن"}),e.jsx("td",{children:s.guarantorData?.name||s.guarantor_name||"-"}),e.jsx("th",{children:"هاتف الضامن"}),e.jsx("td",{children:s.guarantorData?.phone||s.guarantor_phone||"-"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"رقم هوية الضامن"}),e.jsx("td",{colSpan:3,children:s.guarantorData?.idNumber||s.guarantor_id||"-"})]})]}),e.jsx("tr",{children:e.jsx("th",{className:"font-bold",colSpan:4,children:"ملخص العقود"})}),e.jsxs("tr",{children:[e.jsx("th",{children:"إجمالي العقود"}),e.jsx("td",{children:r.total}),e.jsx("th",{children:"إجمالي القيمة"}),e.jsx("td",{children:l(r.totalValue)})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"عقود نشطة"}),e.jsx("td",{children:r.active}),e.jsx("th",{children:"عقود مكتملة"}),e.jsx("td",{children:r.completed})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"عقود ملغاة"}),e.jsx("td",{colSpan:3,children:r.cancelled})]}),e.jsx("tr",{children:e.jsx("th",{className:"font-bold",colSpan:4,children:"ملخص المدفوعات"})}),e.jsxs("tr",{children:[e.jsx("th",{children:"إجمالي المدفوعات"}),e.jsx("td",{children:n.total}),e.jsx("th",{children:"إجمالي المبلغ"}),e.jsx("td",{children:l(n.totalAmount)})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"مدفوعة"}),e.jsx("td",{children:n.paid}),e.jsx("th",{children:"معلقة"}),e.jsx("td",{children:n.pending})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"متأخرة"}),e.jsx("td",{colSpan:3,children:n.overdue})]}),e.jsx("tr",{children:e.jsx("th",{className:"font-bold",colSpan:4,children:"تفاصيل مدفوعات العميل"})}),e.jsxs("tr",{children:[e.jsx("th",{children:"رقم العقد"}),e.jsx("th",{children:"تاريخ الدفع"}),e.jsx("th",{children:"طريقة الدفع"}),e.jsx("th",{children:"المبلغ"})]}),p.length>0?p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.contractNumber||"-"}),e.jsx("td",{children:t.paymentDate||"-"}),e.jsx("td",{children:t.paymentMethod||"-"}),e.jsx("td",{children:l(Number(t.amount||0))})]},`p-${t.id}`)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"لا توجد مدفوعات"})}),e.jsxs("tr",{children:[e.jsx("th",{colSpan:3,children:"الإجمالي المدفوع"}),e.jsx("td",{children:l(f)})]}),e.jsxs("tr",{children:[e.jsx("th",{colSpan:3,children:"المتبقي"}),e.jsx("td",{children:l($)})]})]})})]}),e.jsxs("div",{className:"customer-screen",children:[e.jsxs("div",{className:"flex items-center justify-between no-print",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>w.visit("/customers"),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[s.customer_type==="COMPANY"?e.jsx(S,{className:"h-6 w-6"}):e.jsx(D,{className:"h-6 w-6"}),s.name]}),e.jsxs("p",{className:"text-muted-foreground",children:["رقم العميل: ",s.customer_number]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:B,children:[e.jsx(se,{className:"h-4 w-4"}),"طباعة"]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:O,children:[e.jsx(k,{className:"h-4 w-4"}),"تصدير"]}),e.jsxs(g,{onClick:()=>w.visit(`/customers/${s.id}/edit`),children:[e.jsx(te,{className:"h-4 w-4"}),"تعديل"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 no-print",children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center gap-2 ${b(s.status)}`,children:[c(s.status),s.status==="ACTIVE"?"نشط":"غير نشط"]}),s.rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-4 w-4 text-yellow-500 fill-current"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.rating,"/5"]})]}),s.warnings&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"تحذيرات"})]})]}),e.jsx("div",{className:"border-b no-print",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"overview",label:"نظرة عامة",icon:v},{id:"contracts",label:"العقود",icon:d},{id:"payments",label:"المدفوعات",icon:y},{id:"notes",label:"الملاحظات",icon:d}].map(t=>{const a=t.icon;return e.jsxs("button",{onClick:()=>u(t.id),className:`flex items-center gap-2 py-2 px-1 border-b-2 font-medium text-sm ${i===t.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(a,{className:"h-4 w-4"}),t.label]},t.id)})})}),i==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"المعلومات الأساسية"]})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"رقم العميل"}),e.jsx("p",{className:"text-sm font-mono font-semibold",children:s.customer_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"الاسم الكامل"}),e.jsx("p",{className:"text-sm font-semibold",children:s.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"نوع العميل"}),e.jsx("p",{className:"text-sm",children:s.customer_type==="COMPANY"?"شركة":"فرد"})]}),s.customer_type==="INDIVIDUAL"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"رقم الهوية"}),e.jsx("p",{className:"text-sm font-mono",children:s.id_number||"-"})]}),s.customer_type==="COMPANY"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"السجل التجاري"}),e.jsx("p",{className:"text-sm font-mono",children:s.commercial_record||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"الجنسية"}),e.jsx("p",{className:"text-sm",children:s.nationality||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"رقم الهاتف الرئيسي"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("p",{className:"text-sm",children:s.phone||"-"})]})]}),s.phones&&Array.isArray(s.phones)&&s.phones.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:"أرقام الهواتف الإضافية"}),e.jsx("div",{className:"space-y-2",children:s.phones.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(T,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:t.number}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",t.type==="MOBILE"?"جوال":t.type==="LANDLINE"?"أرضي":"واتساب",")"]}),t.label&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["- ",t.label]}),t.isPrimary&&e.jsx("span",{className:"text-xs bg-primary text-white px-2 py-0.5 rounded-full",children:"رئيسي"})]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"البريد الإلكتروني"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("p",{className:"text-sm break-all",children:s.email||"-"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"العنوان"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{className:"h-4 w-4 mt-0.5"}),e.jsx("p",{className:"text-sm",children:s.address||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"تاريخ التسجيل"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("p",{className:"text-sm",children:j(s.registration_date)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"الحالة"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${b(s.status)}`,children:[c(s.status),s.status==="ACTIVE"?"نشط":"غير نشط"]})})]}),s.rating&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"التقييم"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-4 w-4 text-yellow-500 fill-current"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.rating,"/5"]})]})]})]})})]}),(s.guarantorData||s.guarantor_name||s.guarantor_phone||s.guarantor_id)&&e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"معلومات الضامن"]})}),e.jsx(h,{className:"space-y-4",children:s.guarantorData?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"اسم الضامن"}),e.jsx("p",{className:"text-sm",children:s.guarantorData.name||s.guarantor_name||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"هاتف الضامن"}),e.jsx("p",{className:"text-sm",children:s.guarantorData.phone||s.guarantor_phone||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"رقم هوية الضامن"}),e.jsx("p",{className:"text-sm font-mono",children:s.guarantorData.idNumber||s.guarantor_id||"-"})]}),s.guarantorData.nationality&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"جنسية الضامن"}),e.jsx("p",{className:"text-sm",children:s.guarantorData.nationality})]}),s.guarantorData.relationship&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"صلة القرابة"}),e.jsx("p",{className:"text-sm",children:s.guarantorData.relationship})]}),s.guarantorData.workPlace&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"مكان العمل"}),e.jsx("p",{className:"text-sm",children:s.guarantorData.workPlace})]}),s.guarantorData.workPhone&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"هاتف العمل"}),e.jsx("p",{className:"text-sm",children:s.guarantorData.workPhone})]}),s.guarantorData.address&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"عنوان الضامن"}),e.jsx("p",{className:"text-sm",children:s.guarantorData.address})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"اسم الضامن"}),e.jsx("p",{className:"text-sm",children:s.guarantor_name||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"هاتف الضامن"}),e.jsx("p",{className:"text-sm",children:s.guarantor_phone||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"رقم هوية الضامن"}),e.jsx("p",{className:"text-sm font-mono",children:s.guarantor_id||"-"})]})]})})]}),(s.id_card_copy_path||s.guarantor_id_card_copy_path||s.commercial_record_copy_path)&&e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"المرفقات"]})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.id_card_copy_path&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"نسخة البطاقة الشخصية"}),e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{window.open(`/customers/${s.id}/view/id-card`,"_blank")},className:"flex items-center justify-center gap-2 text-sm text-primary hover:underline cursor-pointer flex-1 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"عرض الملف",children:[e.jsx(v,{className:"h-4 w-4"}),"عرض"]}),e.jsxs("button",{onClick:()=>{window.open(`/customers/${s.id}/download/id-card`,"_blank")},className:"flex items-center justify-center gap-2 text-sm text-primary hover:underline cursor-pointer flex-1 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"تحميل الملف",children:[e.jsx(k,{className:"h-4 w-4"}),"تحميل"]})]})})]}),s.guarantor_id_card_copy_path&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"نسخة بطاقة الضامن"}),e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{window.open(`/customers/${s.id}/view/guarantor-id-card`,"_blank")},className:"flex items-center justify-center gap-2 text-sm text-primary hover:underline cursor-pointer flex-1 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"عرض الملف",children:[e.jsx(v,{className:"h-4 w-4"}),"عرض"]}),e.jsxs("button",{onClick:()=>{window.open(`/customers/${s.id}/download/guarantor-id-card`,"_blank")},className:"flex items-center justify-center gap-2 text-sm text-primary hover:underline cursor-pointer flex-1 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"تحميل الملف",children:[e.jsx(k,{className:"h-4 w-4"}),"تحميل"]})]})})]}),s.commercial_record_copy_path&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"نسخة السجل التجاري"}),e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{window.open(`/customers/${s.id}/view/commercial-record`,"_blank")},className:"flex items-center justify-center gap-2 text-sm text-primary hover:underline cursor-pointer flex-1 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"عرض الملف",children:[e.jsx(v,{className:"h-4 w-4"}),"عرض"]}),e.jsxs("button",{onClick:()=>{window.open(`/customers/${s.id}/download/commercial-record`,"_blank")},className:"flex items-center justify-center gap-2 text-sm text-primary hover:underline cursor-pointer flex-1 px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"تحميل الملف",children:[e.jsx(k,{className:"h-4 w-4"}),"تحميل"]})]})})]})]})})]}),(s.notes||s.warnings)&&e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"الملاحظات والتحذيرات"]})}),e.jsxs(h,{className:"space-y-4",children:[s.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"ملاحظات عامة"}),e.jsx("p",{className:"text-sm mt-1 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:s.notes})]}),s.warnings&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-red-500"}),"تحذيرات خاصة"]}),e.jsx("p",{className:"text-sm mt-1 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-800 dark:text-red-200",children:s.warnings})]})]})]})]}),e.jsxs("div",{className:"space-y-6 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:[e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"ملخص العقود"]})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي العقود"}),e.jsx("span",{className:"font-medium",children:r.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"عقود نشطة"}),e.jsx("span",{className:"font-medium text-green-600",children:r.active})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"عقود مكتملة"}),e.jsx("span",{className:"font-medium text-blue-600",children:r.completed})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"عقود ملغاة"}),e.jsx("span",{className:"font-medium text-red-600",children:r.cancelled})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"إجمالي القيمة"}),e.jsx("span",{className:"font-bold text-primary",children:l(r.totalValue)})]})})]})]}),e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"ملخص المدفوعات"]})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي المدفوعات"}),e.jsx("span",{className:"font-medium",children:n.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"مدفوعات مكتملة"}),e.jsx("span",{className:"font-medium text-green-600",children:n.paid})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"مدفوعات معلقة"}),e.jsx("span",{className:"font-medium text-yellow-600",children:n.pending})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"مدفوعات متأخرة"}),e.jsx("span",{className:"font-medium text-red-600",children:n.overdue})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"إجمالي المبلغ"}),e.jsx("span",{className:"font-bold text-primary",children:l(n.totalAmount)})]})})]})]})]})]}),i==="contracts"&&e.jsx("div",{className:"space-y-6 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"قائمة العقود"]})}),e.jsx(h,{children:s.contracts&&s.contracts.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"رقم العقد"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"نوع العقد"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"الحالة"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"تاريخ البدء"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"القيمة الإجمالية"})]})}),e.jsx("tbody",{children:s.contracts.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.contract_number||t.id})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.contract_type||"-"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${b(t.status)}`,children:t.status==="ACTIVE"?"نشط":t.status==="EXPIRED"?"منتهي":t.status==="CANCELLED"?"ملغي":"معلق"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.start_date?j(t.start_date):"-"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.end_date?j(t.end_date):"-"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l(t.total_value??t.amount??0)})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(d,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد عقود لهذا العميل"})]})})]})}),i==="payments"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-[#58d2c8]"}),"مدفوعات العميل"]})}),e.jsx(h,{children:s.contractPayments&&s.contractPayments.length>0?e.jsx("div",{className:"space-y-3",children:s.contractPayments.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-[#58d2c8] transition-colors cursor-pointer",onClick:()=>w.visit(`/payments/${t.id}`),children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"p-2 bg-[#58d2c8]/10 rounded-lg",children:e.jsx(y,{className:"h-5 w-5 text-[#58d2c8]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["#",t.id]}),e.jsx("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",children:t.paymentMethod})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx("span",{children:t.contractNumber})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:t.paymentDate})]}),t.checkNumber&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsxs("span",{children:["رقم الشيك: ",t.checkNumber]})]}),t.bankName&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{children:t.bankName})]})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:l(t.amount)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t.createdAt})]})]}),e.jsx("div",{className:"flex items-center gap-2 mr-4",children:e.jsx(g,{variant:"ghost",size:"icon",className:"p-2 hover:bg-[#58d2c8]/10",onClick:a=>{a.stopPropagation(),w.visit(`/payments/${t.id}`)},title:"عرض التفاصيل",children:e.jsx(v,{className:"h-5 w-5 text-[#58d2c8]"})})})]},t.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"لا توجد مدفوعات لهذا العميل"})]})})]})}),i==="notes"&&e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"ملاحظات العميل"}),e.jsx(M,{customerId:s.id})]})}),e.jsx(h,{children:s.customerNotes&&s.customerNotes.length>0?e.jsx("div",{className:"space-y-4",children:s.customerNotes.map(t=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.title||"ملاحظة"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.created_at?j(t.created_at):"-"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.content||t.note||"-"})]},t.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"لا توجد ملاحظات لهذا العميل"}),e.jsx(M,{customerId:s.id})]})})]})]})]})]})}function M({customerId:s}){const[i,u]=_.useState(!1),{data:N,setData:j,post:l,processing:b,errors:c,reset:r}=z({title:"",content:""}),n=p=>{p.preventDefault(),l(`/customers/${s}/notes`,{onSuccess:()=>{C.success("نجح","تم إضافة الملاحظة بنجاح"),r(),u(!1)},onError:f=>{f.title&&C.error("خطأ",f.title),f.content&&C.error("خطأ",f.content)}})};return e.jsxs(X,{open:i,onOpenChange:u,children:[e.jsx(q,{asChild:!0,children:e.jsxs(g,{className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"إضافة ملاحظة"]})}),e.jsxs(J,{className:"sm:max-w-[500px]",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"إضافة ملاحظة جديدة"}),e.jsx(W,{children:"أضف ملاحظة جديدة للعميل"})]}),e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"title",className:"text-sm font-medium",children:"العنوان"}),e.jsx(Y,{id:"title",value:N.title,onChange:p=>j("title",p.target.value),placeholder:"عنوان الملاحظة",className:c.title?"border-red-500":""}),c.title&&e.jsx("p",{className:"text-sm text-red-500",children:c.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"content",className:"text-sm font-medium",children:"المحتوى"}),e.jsx(G,{id:"content",value:N.content,onChange:p=>j("content",p.target.value),placeholder:"محتوى الملاحظة",rows:5,className:c.content?"border-red-500":""}),c.content&&e.jsx("p",{className:"text-sm text-red-500",children:c.content})]})]}),e.jsxs(Z,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>{u(!1),r()},children:"إلغاء"}),e.jsx(g,{type:"submit",disabled:b,className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white",children:b?"جاري الحفظ...":"حفظ"})]})]})]})]})}export{Ie as default};
