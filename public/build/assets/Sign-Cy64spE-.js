import{a as c,j as e,H as F,r as I}from"./app-CgSVc5Wn.js";import{D as U}from"./download-BmoDfSjl.js";import{T as $}from"./trash-2-CN_eV5Iq.js";import{s as D}from"./use-toast-DoooC-Gp.js";import{C as H,B as P}from"./button-BGcazaoI.js";import{F as C,U as q,C as X,D as Y}from"./user-GZG2W0xx.js";import{C as B}from"./check-Bj4NjL_D.js";import{M as J}from"./map-pin-Bxy-YAXy.js";/* empty css            */function O({onSignatureComplete:t,onSignatureClear:N,width:l=400,height:n=200,strokeColor:g="#000000",strokeWidth:v=2,backgroundColor:x="#ffffff",disabled:u=!1,placeholder:j="اضغط هنا للتوقيع"}){const i=c.useRef(null),[y,d]=c.useState(!1),[k,r]=c.useState(!1),[f,p]=c.useState("");c.useEffect(()=>{const a=i.current;if(!a)return;const s=a.getContext("2d");s&&(s.strokeStyle=g,s.lineWidth=v,s.lineCap="round",s.lineJoin="round",s.fillStyle=x,s.fillRect(0,0,l,n),s.fillStyle="#9CA3AF",s.font="16px Arial",s.textAlign="center",s.fillText(j,l/2,n/2))},[l,n,g,v,x,j]);const w=a=>{if(u)return;d(!0);const s=i.current;if(!s)return;const m=s.getContext("2d");if(!m)return;const o=s.getBoundingClientRect(),T=s.width/o.width,A=s.height/o.height;let h,b;"touches"in a?(h=a.touches[0].clientX,b=a.touches[0].clientY):(h=a.clientX,b=a.clientY);const M=(h-o.left)*T,R=(b-o.top)*A;m.beginPath(),m.moveTo(M,R)},S=a=>{if(!y||u)return;const s=i.current;if(!s)return;const m=s.getContext("2d");if(!m)return;const o=s.getBoundingClientRect(),T=s.width/o.width,A=s.height/o.height;let h,b;"touches"in a?(h=a.touches[0].clientX,b=a.touches[0].clientY):(h=a.clientX,b=a.clientY);const M=(h-o.left)*T,R=(b-o.top)*A;m.lineTo(M,R),m.stroke()},_=()=>{if(!y)return;d(!1),r(!0);const a=i.current;if(a&&t){const s=a.toDataURL("image/png");p(s),t(s)}},E=()=>{const a=i.current;if(!a)return;const s=a.getContext("2d");s&&(s.fillStyle=x,s.fillRect(0,0,l,n),s.fillStyle="#9CA3AF",s.font="16px Arial",s.textAlign="center",s.fillText(j,l/2,n/2),r(!1),p(""),N&&N())},L=()=>{if(!k||!i.current)return;const a=document.createElement("a");a.download=`توقيع_${new Date().toISOString().split("T")[0]}.png`,a.href=f,a.click()};return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50",children:e.jsx("canvas",{ref:i,width:l,height:n,className:`border border-gray-300 rounded cursor-crosshair ${u?"opacity-50 cursor-not-allowed":""}`,onMouseDown:w,onMouseMove:S,onMouseUp:_,onMouseLeave:_,onTouchStart:w,onTouchMove:S,onTouchEnd:_})}),k&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(U,{className:"h-4 w-4"}),"تحميل التوقيع"]}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:[e.jsx($,{className:"h-4 w-4"}),"مسح التوقيع"]})]})]})}function te({contract:t}){const[N,l]=c.useState(!1),[n,g]=c.useState(""),[v,x]=c.useState(!1),[u,j]=c.useState(!1);c.useEffect(()=>{t.customer_signature&&(j(!0),g(t.customer_signature))},[t]);const i=async r=>{g(r),x(!0)},y=async()=>{if(!n||!t){D.error("خطأ","يرجى التوقيع أولاً");return}l(!0);try{I.post(`/contracts/${t.contract_number}/sign`,{signature:n},{onSuccess:()=>{j(!0),x(!1),D.success("نجح","تم التوقيع على العقد بنجاح!")},onError:r=>{D.error("خطأ",r?.message||"حدث خطأ في حفظ التوقيع")},onFinish:()=>{l(!1)}})}catch(r){console.error("خطأ في التوقيع:",r),D.error("خطأ","حدث خطأ في التوقيع"),l(!1)}},d=r=>new Date(r).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric"}),k=(r,f)=>{const p=new Date(r),w=new Date(f),S=Math.abs(w.getTime()-p.getTime());return Math.ceil(S/(1e3*60*60*24))};return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[e.jsx(F,{title:`توقيع العقد ${t.contract_number}`}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#58d2c8]/10 rounded-lg",children:e.jsx(C,{className:"h-6 w-6 text-[#58d2c8]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"توقيع العقد"}),e.jsxs("p",{className:"text-gray-600",children:["رقم العقد: ",t.contract_number]})]})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-100 text-green-800 rounded-lg",children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"تم التوقيع"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"تفاصيل العقد"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"اسم العميل"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.customer_name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"تاريخ العقد"}),e.jsx("p",{className:"font-medium text-gray-900",children:d(t.contract_date)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"مدة الإيجار"}),e.jsxs("p",{className:"font-medium text-gray-900",children:["من ",d(t.start_date)," إلى ",d(t.end_date)]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"القيمة الإجمالية"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[t.amount.toLocaleString()," ر.ع"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"نوع العقد"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.contract_type})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"بعد الخصم"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[t.total_after_discount.toLocaleString()," ر.ع"]})]})]})]})]}),t.delivery_address&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"عنوان التسليم"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-900",children:t.delivery_address}),t.location_map_link&&e.jsxs("a",{href:t.location_map_link,target:"_blank",rel:"noopener noreferrer",className:"text-[#58d2c8] hover:text-[#4AB8B3] text-sm mt-2 inline-block flex items-center gap-1",children:[e.jsx(J,{className:"h-4 w-4"}),"عرض على الخريطة"]})]})]}),t.rental_details&&t.rental_details.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-lg font-bold mb-4 text-black",children:"أولاً: بموجب هذا العقد التزم المالك (الطرف الأول) بتأجير عدد من المعدات للمستأجر (الطرف الثاني) والمبينة أوصافها فيما يلي:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-2 border-black",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white border-2 border-black",children:[e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"م"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"النوع"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"العدد"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"تاريخ الإيجار"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"تاريخ الإرجاع"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"المدة"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"قيمة الإيجار"})]})}),e.jsx("tbody",{children:t.rental_details.map((r,f)=>{const p=k(r.start_date,r.end_date);return e.jsxs("tr",{className:"border-2 border-black",children:[e.jsx("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:f+1}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:r.item_description}),e.jsx("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:r.quantity}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:d(r.start_date)}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:d(r.end_date)}),e.jsxs("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:[p," يوم"]}),e.jsxs("td",{className:"border-2 border-black p-3 text-center font-bold text-black",children:[r.total.toLocaleString()," ر.ع"]})]},r.id)})})]})})]})]}),u?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full inline-block mb-4",children:e.jsx(B,{className:"h-8 w-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"تم التوقيع بنجاح!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"شكراً لتوقيعك على العقد"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"التوقيع على العقد"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"تعليمات التوقيع"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"يرجى مراجعة تفاصيل العقد أعلاه والتوقيع إلكترونياً في المنطقة أدناه. هذا التوقيع له نفس القوة القانونية للتوقيع اليدوي."})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mt-12 pt-8 border-t-2 border-black",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b-2 border-black w-48 mx-auto mb-2 h-16"})}),e.jsx("p",{className:"font-bold text-lg text-black",children:"توقيع الطرف الأول (المؤجر)"}),e.jsx("p",{className:"text-sm text-black mt-2",children:"شركة البعد العالي للتجارة"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"border-2 border-dashed border-[#58d2c8] rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"توقيع العميل"}),e.jsx("p",{className:"text-sm text-gray-600",children:"اضغط واسحب للتوقيع في المنطقة أدناه"})]}),e.jsx("div",{className:"w-full",children:e.jsx(O,{onSignatureComplete:i,onSignatureClear:()=>{g(""),x(!1)},width:300,height:120,strokeColor:"#000000",strokeWidth:2})})]})}),e.jsx("p",{className:"font-bold text-lg text-black",children:"توقيع الطرف الثاني (المستأجر)"}),e.jsx("p",{className:"text-sm text-black mt-2",children:t.customer_name})]})]}),v&&e.jsxs("div",{className:"mt-6 text-center",children:[e.jsxs(P,{onClick:y,disabled:N,className:"px-8 py-3 bg-[#58d2c8] hover:bg-[#4AB8B3] disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center gap-2 mx-auto",children:[e.jsx(B,{className:"h-5 w-5"}),N?"جاري حفظ التوقيع...":"حفظ التوقيع"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"اضغط لحفظ التوقيع والانتقال للصفحة التالية"})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-black text-center text-sm text-black",children:[e.jsxs("p",{className:"mb-1",children:["رقم العقد: ",e.jsx("span",{className:"font-semibold",children:t.contract_number})]}),e.jsxs("p",{children:["تاريخ الإصدار: ",e.jsx("span",{className:"font-semibold",children:d(t.contract_date)})]})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500",children:[e.jsx("p",{children:"شركة البعد العالي للتجارة - جميع الحقوق محفوظة"}),e.jsx("p",{children:"هذا التوقيع الإلكتروني محمي ومؤمن"})]})]})]})}export{te as default};
