import{u as pe,a as d,b as T,j as e,H as je,L as z,r as ge}from"./app-oenMWVKL.js";import{D as ue,h as q,k as B,K as _,P as fe,b as ve}from"./DashboardLayout-D_fa5wd8.js";import{B as n}from"./button-C5DhV-QX.js";import{D as N,b as be,a as w,c as y,d as C,e as k,f as D}from"./dialog-BC0sA6YV.js";import{T as Ne,a as we,b as K,c as U,d as ye,e as u}from"./table-B6koFlvp.js";import{C as R,b as $,c as E,a as P,d as Ce}from"./card-CFQxRo4h.js";import{C as M}from"./checkbox-DG3vgExf.js";import{s as X}from"./use-toast-BHxJ38Ks.js";import{I as m}from"./input-D6FOPswy.js";import{E as ke}from"./eye-BKnrpGcs.js";import{S as De}from"./square-pen-DHPPKx-c.js";import{T as Ue}from"./trash-2-DjXYsQbh.js";/* empty css            */import"./createLucideIcon-DKn4dUsE.js";import"./triangle-alert-DgdFWirN.js";import"./file-text-DtPltam-.js";import"./mail-B7E-s0zQ.js";import"./index-BF7k4sd4.js";import"./check-CYTFV_Sa.js";const W={"access-main-dashboard":"الوصول للوحة التحكم الرئيسية","access-dashboard-reports":"الوصول لتقارير لوحة التحكم","access-dashboard-interactive":"الوصول للوحة التحكم التفاعلية","access-financial-reports":"الوصول للتقارير المالية","access-operations-reports":"الوصول لتقارير التشغيل","access-customer-reports":"الوصول لتقارير العملاء","access-customers":"الوصول لإدارة العملاء","manage-customers":"إدارة العملاء","view-customer-contracts":"عرض عقود العملاء","manage-customer-claims":"إدارة مطالبات العملاء","access-suppliers":"الوصول لإدارة الموردين","manage-suppliers":"إدارة الموردين","view-supplier-invoices":"عرض فواتير الموردين","manage-supplier-purchases":"إدارة مشتريات الموردين","access-inventory":"الوصول لإدارة المخزون","manage-inventory":"إدارة المخزون","purchase-equipment":"شراء المعدات","manage-purchases":"إدارة المشتريات","access-contracts":"الوصول لإدارة العقود","manage-contracts":"إدارة العقود","view-active-contracts":"عرض العقود النشطة","view-expired-contracts":"عرض العقود المنتهية","view-cancelled-contracts":"عرض العقود الملغاة","access-operations":"الوصول لإدارة التشغيل","manage-delivery-orders":"إدارة أوامر التسليم","track-shipping":"تتبع الشحن","manage-delivery-receipt":"إدارة سند التسليم","manage-return-inspection":"إدارة فحص المرتجعات","access-financial":"الوصول لإدارة المالية","manage-payment-transactions":"إدارة معاملات الدفع","manage-invoices":"إدارة الفواتير","view-financial-reports":"عرض التقارير المالية","access-employees":"الوصول لإدارة الموظفين","manage-employees":"إدارة الموظفين","manage-salaries":"إدارة الرواتب","manage-incentives":"إدارة الحوافز","manage-attendance":"إدارة الحضور","manage-departments":"إدارة الأقسام","manage-leaves":"إدارة الإجازات","access-permissions":"الوصول لإدارة الصلاحيات","manage-user-roles":"إدارة أدوار المستخدمين","manage-permission-groups":"إدارة مجموعات الصلاحيات","manage-roles":"إدارة الأدوار","access-payments":"الوصول لإدارة المدفوعات","view-all-payments":"عرض جميع المدفوعات","view-late-payments":"عرض المدفوعات المتأخرة","view-payment-reports":"عرض تقارير المدفوعات","access-settings":"الوصول للإعدادات","manage-electronic-signature":"إدارة التوقيع الإلكتروني"};function G(p){if(W[p])return W[p];const f=(p||"").split("-"),S=f.shift()||"",j=f.join("-"),x={access:"الوصول",manage:"إدارة",view:"عرض",track:"تتبع"},F={"main-dashboard":"لوحة التحكم الرئيسية",dashboard:"لوحة التحكم",reports:"التقارير",customers:"العملاء",suppliers:"الموردين",inventory:"المخزون",contracts:"العقود",operations:"التشغيل",financial:"المالية",employees:"الموظفين",permissions:"الصلاحيات",settings:"الإعدادات",payments:"المدفوعات"}[j]||j.replace(/-/g," ");return`${x[S]||S} ${F}`.trim()}function We({users:p,allRoles:f,allPermissions:S,stats:j}){const{flash:x,auth:V}=pe().props,[F,g]=d.useState(!1),[I,v]=d.useState(!1),[J,A]=d.useState(!1),[Q,O]=d.useState(!1),[Y,b]=d.useState(!1),[Z,L]=d.useState(!1),[t,o]=d.useState(null),[ee,H]=d.useState(!1),a=T({name:"",email:"",phone:"",password:"",roles:[]}),i=T({roles:[]}),c=T({permissions:[]}),l=T({name:"",email:"",phone:"",password:""}),se=async s=>{try{const r=await fetch(`/user-roles/${s.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!r.ok)o(s);else{const h=await r.json();o(h)}}catch{o(s)}O(!0)},ae=s=>{o(s),l.setData({name:s.name||"",email:s.email||"",phone:s.phone||"",password:""}),b(!0)},re=()=>{t&&l.put(`/user-roles/${t.id}`,{onSuccess:()=>{b(!1),o(null),l.reset()}})},le=s=>{o(s),L(!0)},te=async()=>{if(t)return H(!0),new Promise((s,r)=>{ge.delete(`/user-roles/${t.id}`,{onFinish:()=>{H(!1),s()},onError:()=>{H(!1),r()}})})};d.useEffect(()=>{x?.success&&(X.success("نجح",x.success),g(!1),v(!1),A(!1),O(!1),b(!1),L(!1),i.reset(),c.reset(),a.reset(),l.reset(),o(null)),x?.error&&X.error("خطأ",x.error)},[x]);const ne=()=>{a.post("/user-roles",{onSuccess:()=>{a.reset()}})},ie=s=>{const r=a.data.roles||[];r.includes(s)?a.setData("roles",r.filter(h=>h!==s)):a.setData("roles",[...r,s])},ce=s=>{o(s),i.setData({roles:s.roles.map(r=>r.id)}),g(!0)},oe=()=>{t&&i.put(`/user-roles/${t.id}/roles`,{onSuccess:()=>{g(!1),o(null),i.reset()}})},de=s=>{o(s),c.setData({permissions:s.permissions.map(r=>r.id)}),v(!0)},me=()=>{t&&c.put(`/user-roles/${t.id}/permissions`,{onSuccess:()=>{v(!1),o(null),c.reset()}})},xe=s=>{const r=i.data.roles||[];r.includes(s)?i.setData("roles",r.filter(h=>h!==s)):i.setData("roles",[...r,s])},he=s=>{const r=c.data.permissions||[];r.includes(s)?c.setData("permissions",r.filter(h=>h!==s)):c.setData("permissions",[...r,s])};return e.jsxs(ue,{children:[e.jsx(je,{title:"أدوار المستخدمين"}),e.jsxs("div",{className:"w-full space-y-6 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(z,{href:"/dashboard/user-roles",className:"px-4 py-2 bg-[rgb(30,64,175)] text-white rounded-lg hover:bg-[rgb(25,55,150)] transition-colors flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"أدوار المستخدمين"]}),e.jsxs(z,{href:"/dashboard/roles",className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"الأدوار"]}),e.jsxs(z,{href:"/dashboard/permission-groups",className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"مجموعات الصلاحيات"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-xl font-semibold",children:"أدوار المستخدمين"})]}),e.jsxs(N,{open:J,onOpenChange:A,children:[e.jsx(be,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(fe,{className:"h-4 w-4"}),"إضافة مستخدم جديد"]})}),e.jsxs(w,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(C,{children:"إضافة مستخدم جديد"}),e.jsx(k,{children:"قم بإنشاء مستخدم جديد وتعيين الأدوار له"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الاسم"}),e.jsx(m,{value:a.data.name,onChange:s=>a.setData("name",s.target.value),placeholder:"اسم المستخدم"}),a.errors.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"البريد الإلكتروني"}),e.jsx(m,{type:"email",value:a.data.email,onChange:s=>a.setData("email",s.target.value),placeholder:"example@email.com"}),a.errors.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"رقم الهاتف"}),e.jsx(m,{value:a.data.phone,onChange:s=>a.setData("phone",s.target.value),placeholder:"رقم الهاتف (اختياري)"}),a.errors.phone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"كلمة المرور"}),e.jsx(m,{type:"password",value:a.data.password,onChange:s=>a.setData("password",s.target.value),placeholder:"كلمة المرور"}),a.errors.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.password})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الأدوار"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(M,{id:`create-user-role-${s.id}`,checked:a.data.roles?.includes(s.id),onCheckedChange:()=>ie(s.id)}),e.jsx("label",{htmlFor:`create-user-role-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),a.errors.roles&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.roles})]})]}),e.jsxs(D,{children:[e.jsx(n,{variant:"outline",onClick:()=>A(!1),children:"إلغاء"}),e.jsx(n,{onClick:ne,disabled:a.processing,children:a.processing?"جاري الحفظ...":"حفظ"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(R,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"إجمالي المستخدمين"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(P,{children:e.jsx("div",{className:"text-2xl font-bold",children:j.totalUsers})})]}),e.jsxs(R,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"إجمالي الأدوار"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(P,{children:e.jsx("div",{className:"text-2xl font-bold",children:j.totalRoles})})]}),e.jsxs(R,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"إجمالي الصلاحيات"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(P,{children:e.jsx("div",{className:"text-2xl font-bold",children:j.totalPermissions})})]})]}),e.jsxs(R,{children:[e.jsxs($,{children:[e.jsx(E,{children:"قائمة المستخدمين"}),e.jsx(Ce,{children:"إدارة أدوار وصلاحيات المستخدمين"})]}),e.jsx(P,{children:e.jsxs(Ne,{children:[e.jsx(we,{children:e.jsxs(K,{children:[e.jsx(U,{children:"الاسم"}),e.jsx(U,{children:"البريد الإلكتروني"}),e.jsx(U,{children:"الأدوار"}),e.jsx(U,{children:"الصلاحيات"}),e.jsx(U,{className:"text-left",children:"الإجراءات"})]})}),e.jsx(ye,{children:p.length===0?e.jsx(K,{children:e.jsx(u,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"لا يوجد مستخدمون"})}):p.map(s=>e.jsxs(K,{children:[e.jsx(u,{className:"font-medium",children:s.name}),e.jsx(u,{children:s.email}),e.jsx(u,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.roles.length>0?s.roles.map(r=>e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 rounded",children:r.name},r.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد أدوار"})})}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions.length>0?s.permissions.slice(0,2).map(r=>e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 rounded",children:G(r.name)},r.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد صلاحيات"}),s.permissions.length>2&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.permissions.length-2," أكثر"]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>ce(s),children:[e.jsx(B,{className:"h-4 w-4"}),"أدوار"]}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>de(s),children:[e.jsx(_,{className:"h-4 w-4"}),"صلاحيات"]}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>se(s),title:"عرض","aria-label":"عرض",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>ae(s),title:"تعديل","aria-label":"تعديل",children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>le(s),disabled:V?.user?.id===s.id,title:"حذف","aria-label":"حذف",children:e.jsx(Ue,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsx(N,{open:Q,onOpenChange:O,children:e.jsxs(w,{className:"max-w-lg",children:[e.jsxs(y,{children:[e.jsx(C,{children:"عرض المستخدم"}),e.jsx(k,{children:"تفاصيل المستخدم والصلاحيات"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"الاسم:"})," ",t?.name]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"البريد:"})," ",t?.email]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"الهاتف:"})," ",t?.phone||"-"]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"الأدوار"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t?.roles?.length?t.roles.map(s=>e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 rounded",children:s.name},s.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد أدوار"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"الصلاحيات"}),e.jsx("div",{className:"flex flex-wrap gap-1 max-h-40 overflow-y-auto border rounded p-2",children:t?.permissions?.length?t.permissions.map(s=>e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 rounded",children:G(s.name)},s.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد صلاحيات"})})]})]}),e.jsx(D,{children:e.jsx(n,{variant:"outline",onClick:()=>O(!1),children:"إغلاق"})})]})}),e.jsx(N,{open:Y,onOpenChange:b,children:e.jsxs(w,{className:"max-w-2xl",children:[e.jsxs(y,{children:[e.jsx(C,{children:"تعديل المستخدم"}),e.jsx(k,{children:"تعديل بيانات المستخدم الأساسية"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الاسم"}),e.jsx(m,{value:l.data.name,onChange:s=>l.setData("name",s.target.value),placeholder:"اسم المستخدم"}),l.errors.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.errors.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"البريد الإلكتروني"}),e.jsx(m,{type:"email",value:l.data.email,onChange:s=>l.setData("email",s.target.value),placeholder:"example@email.com"}),l.errors.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.errors.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"رقم الهاتف"}),e.jsx(m,{value:l.data.phone,onChange:s=>l.setData("phone",s.target.value),placeholder:"رقم الهاتف (اختياري)"}),l.errors.phone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.errors.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"كلمة المرور (اختياري)"}),e.jsx(m,{type:"password",value:l.data.password,onChange:s=>l.setData("password",s.target.value),placeholder:"اتركه فارغاً إذا لا تريد التغيير"}),l.errors.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.errors.password})]})]}),e.jsxs(D,{children:[e.jsx(n,{variant:"outline",onClick:()=>b(!1),children:"إلغاء"}),e.jsx(n,{onClick:re,disabled:l.processing,children:l.processing?"جاري الحفظ...":"حفظ"})]})]})}),e.jsx(ve,{open:Z,onOpenChange:L,onConfirm:te,title:"حذف المستخدم",description:`هل أنت متأكد من حذف المستخدم: ${t?.name||""} ؟`,confirmText:"حذف",cancelText:"إلغاء",variant:"danger",isLoading:ee}),e.jsx(N,{open:F,onOpenChange:g,children:e.jsxs(w,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(C,{children:"تعديل أدوار المستخدم"}),e.jsxs(k,{children:["قم بتعيين الأدوار للمستخدم: ",t?.name]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الأدوار"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(M,{id:`role-${s.id}`,checked:i.data.roles?.includes(s.id),onCheckedChange:()=>xe(s.id)}),e.jsx("label",{htmlFor:`role-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),i.errors.roles&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.errors.roles})]})}),e.jsxs(D,{children:[e.jsx(n,{variant:"outline",onClick:()=>g(!1),children:"إلغاء"}),e.jsx(n,{onClick:oe,disabled:i.processing,children:i.processing?"جاري الحفظ...":"حفظ"})]})]})}),e.jsx(N,{open:I,onOpenChange:v,children:e.jsxs(w,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(C,{children:"تعديل صلاحيات المستخدم"}),e.jsxs(k,{children:["قم بتعيين الصلاحيات للمستخدم: ",t?.name]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الصلاحيات"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:S.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(M,{id:`permission-${s.id}`,checked:c.data.permissions?.includes(s.id),onCheckedChange:()=>he(s.id)}),e.jsx("label",{htmlFor:`permission-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),c.errors.permissions&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.errors.permissions})]})}),e.jsxs(D,{children:[e.jsx(n,{variant:"outline",onClick:()=>v(!1),children:"إلغاء"}),e.jsx(n,{onClick:me,disabled:c.processing,children:c.processing?"جاري الحفظ...":"حفظ"})]})]})})]})]})}export{We as default};
