import{u as X,a as h,b as w,j as e,H as Y}from"./app-8gmTTw34.js";import{D as Z,f as $,P as I,i as H,K as E}from"./DashboardLayout-DhkYYcHy.js";import{B as i}from"./button-jR2lg-Ad.js";import{D,b as ee,a as y,c as k,d as U,e as T,f as R}from"./dialog-CsJ_Z5g7.js";import{T as se,a as ae,b as S,c as j,d as le,e as c}from"./table-Ci-zSf9g.js";import{C as u,b as f,c as g,a as N,d as re}from"./card-DbSr2bDZ.js";import{C as O}from"./checkbox-BghZwPPd.js";import{s as B}from"./use-toast-C82IQcBD.js";import{I as b}from"./input-BTjsHf1Q.js";/* empty css            */import"./user-DAMzRv9g.js";import"./eye-BHi5eQqe.js";import"./index-CXTtIFfJ.js";import"./check-DTWGydgR.js";function Ne({users:P,allRoles:F,allPermissions:z,stats:v}){const{flash:d}=X().props,[K,o]=h.useState(!1),[L,m]=h.useState(!1),[_,C]=h.useState(!1),[n,p]=h.useState(null),a=w({name:"",email:"",phone:"",password:"",roles:[]}),r=w({roles:[]}),t=w({permissions:[]});h.useEffect(()=>{d?.success&&(B.success("نجح",d.success),o(!1),m(!1),C(!1),r.reset(),t.reset(),a.reset()),d?.error&&B.error("خطأ",d.error)},[d]);const q=()=>{a.post("/user-roles",{onSuccess:()=>{a.reset()}})},A=s=>{const l=a.data.roles||[];l.includes(s)?a.setData("roles",l.filter(x=>x!==s)):a.setData("roles",[...l,s])},G=s=>{p(s),r.setData({roles:s.roles.map(l=>l.id)}),o(!0)},J=()=>{n&&r.put(`/user-roles/${n.id}/roles`,{onSuccess:()=>{o(!1),p(null),r.reset()}})},M=s=>{p(s),t.setData({permissions:s.permissions.map(l=>l.id)}),m(!0)},Q=()=>{n&&t.put(`/user-roles/${n.id}/permissions`,{onSuccess:()=>{m(!1),p(null),t.reset()}})},V=s=>{const l=r.data.roles||[];l.includes(s)?r.setData("roles",l.filter(x=>x!==s)):r.setData("roles",[...l,s])},W=s=>{const l=t.data.permissions||[];l.includes(s)?t.setData("permissions",l.filter(x=>x!==s)):t.setData("permissions",[...l,s])};return e.jsxs(Z,{children:[e.jsx(Y,{title:"أدوار المستخدمين"}),e.jsxs("div",{className:"w-full space-y-6 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-xl font-semibold",children:"أدوار المستخدمين"})]}),e.jsxs(D,{open:_,onOpenChange:C,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(i,{children:[e.jsx(I,{className:"h-4 w-4"}),"إضافة مستخدم جديد"]})}),e.jsxs(y,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(U,{children:"إضافة مستخدم جديد"}),e.jsx(T,{children:"قم بإنشاء مستخدم جديد وتعيين الأدوار له"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الاسم"}),e.jsx(b,{value:a.data.name,onChange:s=>a.setData("name",s.target.value),placeholder:"اسم المستخدم"}),a.errors.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"البريد الإلكتروني"}),e.jsx(b,{type:"email",value:a.data.email,onChange:s=>a.setData("email",s.target.value),placeholder:"example@email.com"}),a.errors.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"رقم الهاتف"}),e.jsx(b,{value:a.data.phone,onChange:s=>a.setData("phone",s.target.value),placeholder:"رقم الهاتف (اختياري)"}),a.errors.phone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"كلمة المرور"}),e.jsx(b,{type:"password",value:a.data.password,onChange:s=>a.setData("password",s.target.value),placeholder:"كلمة المرور"}),a.errors.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.password})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الأدوار"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:F.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(O,{id:`create-user-role-${s.id}`,checked:a.data.roles?.includes(s.id),onCheckedChange:()=>A(s.id)}),e.jsx("label",{htmlFor:`create-user-role-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),a.errors.roles&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.errors.roles})]})]}),e.jsxs(R,{children:[e.jsx(i,{variant:"outline",onClick:()=>C(!1),children:"إلغاء"}),e.jsx(i,{onClick:q,disabled:a.processing,children:a.processing?"جاري الحفظ...":"حفظ"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(u,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"إجمالي المستخدمين"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalUsers})})]}),e.jsxs(u,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"إجمالي الأدوار"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalRoles})})]}),e.jsxs(u,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"إجمالي الصلاحيات"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalPermissions})})]})]}),e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"قائمة المستخدمين"}),e.jsx(re,{children:"إدارة أدوار وصلاحيات المستخدمين"})]}),e.jsx(N,{children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(S,{children:[e.jsx(j,{children:"الاسم"}),e.jsx(j,{children:"البريد الإلكتروني"}),e.jsx(j,{children:"الأدوار"}),e.jsx(j,{children:"الصلاحيات"}),e.jsx(j,{className:"text-left",children:"الإجراءات"})]})}),e.jsx(le,{children:P.length===0?e.jsx(S,{children:e.jsx(c,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"لا يوجد مستخدمون"})}):P.map(s=>e.jsxs(S,{children:[e.jsx(c,{className:"font-medium",children:s.name}),e.jsx(c,{children:s.email}),e.jsx(c,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.roles.length>0?s.roles.map(l=>e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 rounded",children:l.name},l.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد أدوار"})})}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions.length>0?s.permissions.slice(0,2).map(l=>e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 rounded",children:l.name},l.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"لا توجد صلاحيات"}),s.permissions.length>2&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.permissions.length-2," أكثر"]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>G(s),children:[e.jsx(H,{className:"h-4 w-4"}),"أدوار"]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>M(s),children:[e.jsx(E,{className:"h-4 w-4"}),"صلاحيات"]})]})})]},s.id))})]})})]}),e.jsx(D,{open:K,onOpenChange:o,children:e.jsxs(y,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(U,{children:"تعديل أدوار المستخدم"}),e.jsxs(T,{children:["قم بتعيين الأدوار للمستخدم: ",n?.name]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الأدوار"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:F.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(O,{id:`role-${s.id}`,checked:r.data.roles?.includes(s.id),onCheckedChange:()=>V(s.id)}),e.jsx("label",{htmlFor:`role-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),r.errors.roles&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.errors.roles})]})}),e.jsxs(R,{children:[e.jsx(i,{variant:"outline",onClick:()=>o(!1),children:"إلغاء"}),e.jsx(i,{onClick:J,disabled:r.processing,children:r.processing?"جاري الحفظ...":"حفظ"})]})]})}),e.jsx(D,{open:L,onOpenChange:m,children:e.jsxs(y,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(U,{children:"تعديل صلاحيات المستخدم"}),e.jsxs(T,{children:["قم بتعيين الصلاحيات للمستخدم: ",n?.name]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الصلاحيات"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-60 overflow-y-auto space-y-2",children:z.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(O,{id:`permission-${s.id}`,checked:t.data.permissions?.includes(s.id),onCheckedChange:()=>W(s.id)}),e.jsx("label",{htmlFor:`permission-${s.id}`,className:"text-sm cursor-pointer",children:s.name})]},s.id))}),t.errors.permissions&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.errors.permissions})]})}),e.jsxs(R,{children:[e.jsx(i,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),e.jsx(i,{onClick:Q,disabled:t.processing,children:t.processing?"جاري الحفظ...":"حفظ"})]})]})})]})]})}export{Ne as default};
