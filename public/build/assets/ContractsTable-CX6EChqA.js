import{a as l,j as e}from"./app-453UjHFF.js";import{u as M,f as y,g as F,a as B,b as D,c as K}from"./index-BHEpRP0W.js";import{C as A,b as L,c as T,a as V}from"./card-DnHnLnGP.js";import{B as o}from"./button-395y-YJ9.js";import{C as z}from"./combobox-pd5F4DwU.js";import{U as G,a as $,c as E,R as H,P as w,S as U,d as _,e as q}from"./DashboardLayout-Czf7bn8d.js";import{G as J}from"./git-branch-Cm6TYA4n.js";import{E as O}from"./eye-BlYIXZZl.js";import{S as Q}from"./square-pen-c-oDhOYz.js";import{P as W}from"./printer-CqJ7r43C.js";import{T as X}from"./trash-2-DsJVWiiH.js";import{C as Y}from"./chevron-left-C4XuCa2H.js";function de({data:u,onAddContract:h,onEditContract:p,onDeleteContract:b,onViewContract:j,onViewStages:c,onPrint:i,onIssueInvoice:d,isLoading:f=!1}){const[v,k]=l.useState([]),[C,S]=l.useState([]),[r,N]=l.useState(""),[n,P]=l.useState("all"),R=t=>{switch(t){case"نشط":case"مفتوحة":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"مغلقة":case"إيجار مغلقة":case"مكتمل":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400";case"مغلقة - البضاعة غير مستلمة":return"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400";case"منتهي":return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400";case"ملغي":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";default:return"bg-gray-100 text-gray-800"}},x=l.useMemo(()=>u.filter(t=>{const a=t.customerName.toLowerCase().includes(r.toLowerCase())||t.contractNumber.toLowerCase().includes(r.toLowerCase())||t.status.toLowerCase().includes(r.toLowerCase()),g=n==="all"||t.status===n;return a&&g}),[u,r,n]),m=l.useMemo(()=>[{accessorKey:"contractNumber",header:"رقم العقد",cell:({row:t})=>{const a=t.getValue("contractNumber");return e.jsx("a",{href:`/contract/sign/${a}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-[#58d2c8] hover:text-[#4AB8B3] hover:underline transition-colors cursor-pointer",onClick:g=>{g.preventDefault(),window.open(`/contract/sign/${a}`,"_blank")},children:a})}},{accessorKey:"customerName",header:"العميل",cell:({row:t})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:t.getValue("customerName")})]})},{accessorKey:"customerPhone",header:"رقم الجوال",cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-gray-900 dark:text-white",children:t.getValue("customerPhone")||"-"})})},{accessorKey:"totalAfterDiscount",header:"الإجمالي",cell:({row:t})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Number(t.getValue("totalAfterDiscount")).toFixed(2)," ر.ع"]})]})},{accessorKey:"totalPayments",header:"المدفوع",cell:({row:t})=>e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:[Number(t.getValue("totalPayments")).toFixed(2)," ر.ع"]})},{accessorKey:"remainingAmount",header:"المتبقي",cell:({row:t})=>{const a=Number(t.getValue("remainingAmount"));return e.jsxs("span",{className:`font-medium ${a>0?"text-orange-600 dark:text-orange-400":"text-green-600 dark:text-green-400"}`,children:[a.toFixed(2)," ر.ع"]})}},{accessorKey:"status",header:"الحالة",cell:({row:t})=>{const a=t.getValue("status");return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R(a)}`,children:a})}},{accessorKey:"startDate",header:"التواريخ",cell:({row:t})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:["من: ",t.original.startDate]}),e.jsxs("div",{children:["إلى: ",t.original.endDate]})]})]})},{id:"actions",header:"الإجراءات",cell:({row:t})=>{const a=t.original;return e.jsx("div",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx("button",{onClick:()=>c(a),className:"text-purple-600 hover:text-purple-700 transition-colors p-1",title:"عرض المراحل",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j(a),className:"text-[#58d2c8] hover:text-[#4AB8B3] transition-colors p-1",title:"عرض التفاصيل",children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>p(a),className:"text-blue-600 hover:text-blue-700 transition-colors p-1",title:"تعديل",children:e.jsx(Q,{className:"h-4 w-4"})}),i&&e.jsx("button",{onClick:()=>i(a),className:"text-green-600 hover:text-green-700 transition-colors p-1",title:"طباعة",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>b(a),className:"text-red-600 hover:text-red-700 transition-colors p-1",title:"حذف",children:e.jsx(X,{className:"h-4 w-4"})})]}),d&&e.jsxs("button",{onClick:()=>d(a),className:"flex items-center justify-center gap-2 px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white text-xs font-medium rounded-lg transition-colors whitespace-nowrap",title:"إصدار فاتورة",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),"إصدار فاتورة"]})]})})}}],[j,p,b,c,i,d]),s=M({data:x,columns:m,getCoreRowModel:K(),getFilteredRowModel:D(),getSortedRowModel:B(),getPaginationRowModel:F(),onSortingChange:k,onColumnFiltersChange:S,onGlobalFilterChange:N,state:{sorting:v,columnFilters:C,globalFilter:r},initialState:{pagination:{pageSize:10}}});return e.jsxs(A,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx(T,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"جدول العقود"}),e.jsxs(o,{onClick:h,className:"flex items-center gap-2 bg-[#58d2c8] hover:bg-[#4AB8B3]",children:[e.jsx(w,{className:"h-4 w-4"}),"إضافة عقد جديد"]})]})}),e.jsxs(V,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(U,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"البحث في العقود...",value:r,onChange:t=>N(t.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent"})]}),e.jsx(z,{options:[{value:"all",label:"جميع الحالات"},{value:"نشط",label:"نشط"},{value:"مفتوحة",label:"مفتوحة"},{value:"مغلقة",label:"مغلقة"},{value:"إيجار مغلقة",label:"إيجار مغلقة"},{value:"مغلقة - البضاعة غير مستلمة",label:"مغلقة - البضاعة غير مستلمة"},{value:"منتهي",label:"منتهي"},{value:"ملغي",label:"ملغي"},{value:"مكتمل",label:"مكتمل"}],value:n,onValueChange:t=>P(t),placeholder:"الحالة",searchPlaceholder:"ابحث...",emptyText:"لا توجد نتائج",className:"w-full sm:w-[180px]"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[1200px]",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:s.getHeaderGroups().map(t=>t.headers.map(a=>e.jsx("th",{className:"text-right py-3 px-2 sm:px-4 font-medium text-gray-900 dark:text-white text-sm",children:a.isPlaceholder?null:y(a.column.columnDef.header,a.getContext())},a.id)))})}),e.jsx("tbody",{children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:m.length,className:"text-center py-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#58d2c8] border-t-transparent rounded-full animate-spin"})})})}):s.getRowModel().rows.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:m.length,className:"text-center py-8",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"لا توجد عقود"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"لم يتم العثور على عقود تطابق معايير البحث"}),e.jsxs(o,{onClick:h,className:"bg-[#58d2c8] hover:bg-[#4AB8B3]",children:[e.jsx(w,{className:"h-4 w-4 ml-2"}),"إضافة عقد جديد"]})]})}):s.getRowModel().rows.map(t=>e.jsx("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:t.getVisibleCells().map(a=>e.jsx("td",{className:"py-3 px-2 sm:px-4",children:y(a.column.columnDef.cell,a.getContext())},a.id))},t.id))})]})}),!f&&s.getRowModel().rows.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["عرض ",s.getState().pagination.pageIndex*s.getState().pagination.pageSize+1," إلى"," ",Math.min((s.getState().pagination.pageIndex+1)*s.getState().pagination.pageSize,x.length)," ","من ",x.length," عقد"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx(q,{className:"h-4 w-4"}),"السابق"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:["التالي",e.jsx(Y,{className:"h-4 w-4"})]})]})]})]})]})}export{de as C};
