import{a as c,j as e,H as U,r as P}from"./app-CyMgrt3T.js";import{D as $}from"./download-Da8sFeMc.js";import{T as I}from"./trash-2-Bkqmg5sf.js";import{s as y}from"./use-toast-C91E3Tui.js";import{B as E,C as H}from"./button-BYQHTvmA.js";import{F as T}from"./file-text-DXOoDEiS.js";import{P as O}from"./printer-DGliQzWw.js";import{C as X}from"./check-npnK0bck.js";import{U as q,C as F,D as L}from"./user-BsMlQm9m.js";import{M as z}from"./map-pin-BsWZEFoE.js";/* empty css            */import"./createLucideIcon-BYf3FF-E.js";function J({onSignatureComplete:s,onSignatureClear:v,width:n=400,height:i=200,strokeColor:u="#000000",strokeWidth:w=2,backgroundColor:h="#ffffff",disabled:f=!1,placeholder:N="اضغط هنا للتوقيع"}){const o=c.useRef(null),[x,b]=c.useState(!1),[_,S]=c.useState(!1),[m,D]=c.useState("");c.useEffect(()=>{const a=o.current;if(!a)return;const t=a.getContext("2d");t&&(t.strokeStyle=u,t.lineWidth=w,t.lineCap="round",t.lineJoin="round",t.fillStyle=h,t.fillRect(0,0,n,i),t.fillStyle="#9CA3AF",t.font="16px Arial",t.textAlign="center",t.fillText(N,n/2,i/2))},[n,i,u,w,h,N]);const C=a=>{if(f)return;b(!0);const t=o.current;if(!t)return;const g=t.getContext("2d");if(!g)return;const d=t.getBoundingClientRect(),M=t.width/d.width,B=t.height/d.height;let p,j;"touches"in a?(p=a.touches[0].clientX,j=a.touches[0].clientY):(p=a.clientX,j=a.clientY);const R=(p-d.left)*M,Y=(j-d.top)*B;g.beginPath(),g.moveTo(R,Y)},r=a=>{if(!x||f)return;const t=o.current;if(!t)return;const g=t.getContext("2d");if(!g)return;const d=t.getBoundingClientRect(),M=t.width/d.width,B=t.height/d.height;let p,j;"touches"in a?(p=a.touches[0].clientX,j=a.touches[0].clientY):(p=a.clientX,j=a.clientY);const R=(p-d.left)*M,Y=(j-d.top)*B;g.lineTo(R,Y),g.stroke()},l=()=>{if(!x)return;b(!1),S(!0);const a=o.current;if(a&&s){const t=a.toDataURL("image/png");D(t),s(t)}},k=()=>{const a=o.current;if(!a)return;const t=a.getContext("2d");t&&(t.fillStyle=h,t.fillRect(0,0,n,i),t.fillStyle="#9CA3AF",t.font="16px Arial",t.textAlign="center",t.fillText(N,n/2,i/2),S(!1),D(""),v&&v())},A=()=>{if(!_||!o.current)return;const a=document.createElement("a");a.download=`توقيع_${new Date().toISOString().split("T")[0]}.png`,a.href=m,a.click()};return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50",children:e.jsx("canvas",{ref:o,width:n,height:i,className:`border border-gray-300 rounded cursor-crosshair ${f?"opacity-50 cursor-not-allowed":""}`,onMouseDown:C,onMouseMove:r,onMouseUp:l,onMouseLeave:l,onTouchStart:C,onTouchMove:r,onTouchEnd:l})}),_&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx($,{className:"h-4 w-4"}),"تحميل التوقيع"]}),e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:[e.jsx(I,{className:"h-4 w-4"}),"مسح التوقيع"]})]})]})}function ne({contract:s}){const[v,n]=c.useState(!1),[i,u]=c.useState(""),[w,h]=c.useState(!1),[f,N]=c.useState(!1),x=(typeof window<"u"?window.location.pathname:"").split("/contract/sign/")[1]||"",b=x||s?.contract_number||"";c.useEffect(()=>{if(!s){y.error("خطأ","لم يتم العثور على بيانات العقد");return}x&&s.contract_number!==x&&console.warn(`تحذير: رقم العقد في البيانات (${s.contract_number}) لا يطابق الرابط (${x})`),s.customer_signature&&(N(!0),u(s.customer_signature))},[s,x]);const _=async r=>{u(r),h(!0)},S=async()=>{if(!i||!s){y.error("خطأ","يرجى التوقيع أولاً");return}n(!0);const r=b||s.contract_number;try{P.post(`/contracts/${r}/sign`,{signature:i},{onSuccess:()=>{N(!0),h(!1),y.success("نجح","تم التوقيع على العقد بنجاح!")},onError:l=>{y.error("خطأ",l?.message||"حدث خطأ في حفظ التوقيع")},onFinish:()=>{n(!1)}})}catch(l){console.error("خطأ في التوقيع:",l),y.error("خطأ","حدث خطأ في التوقيع"),n(!1)}},m=r=>new Date(r).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric"}),D=(r,l)=>{const k=new Date(r),A=new Date(l),a=Math.abs(A.getTime()-k.getTime());return Math.ceil(a/(1e3*60*60*24))},C=()=>{window.print()};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:`توقيع العقد ${b}`}),e.jsx("style",{children:`
        @media print {
          @page {
            size: A4;
            margin: 10mm;
          }
          body {
            margin: 0;
            padding: 0;
          }
          .no-print {
            display: none !important;
          }
          .print-container {
            max-width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            box-shadow: none !important;
            background: white !important;
          }
          .print-container * {
            color: black !important;
            background: white !important;
          }
          .print-break {
            page-break-inside: avoid;
          }
          .print-page {
            page-break-after: always;
          }
          .print-page:last-child {
            page-break-after: auto;
          }
        }
      `}),e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6 no-print",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#58d2c8]/10 rounded-lg",children:e.jsx(T,{className:"h-6 w-6 text-[#58d2c8]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"توقيع العقد"}),e.jsxs("p",{className:"text-gray-600",children:["رقم العقد: ",b]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{onClick:C,className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"طباعة العقد"]}),f&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-100 text-green-800 rounded-lg",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"تم التوقيع"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6 print-container print-break",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"تفاصيل العقد"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"اسم العميل"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.customer_name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"تاريخ العقد"}),e.jsx("p",{className:"font-medium text-gray-900",children:m(s.contract_date)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"مدة الإيجار"}),e.jsxs("p",{className:"font-medium text-gray-900",children:["من ",m(s.start_date)," إلى ",m(s.end_date)]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"القيمة الإجمالية"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.amount.toLocaleString()," ر.ع"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"نوع العقد"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.contract_type})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"بعد الخصم"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.total_after_discount.toLocaleString()," ر.ع"]})]})]})]})]}),s.delivery_address&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"عنوان التسليم"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-900",children:s.delivery_address}),s.location_map_link&&e.jsxs("a",{href:s.location_map_link,target:"_blank",rel:"noopener noreferrer",className:"text-[#58d2c8] hover:text-[#4AB8B3] text-sm mt-2 inline-block flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4"}),"عرض على الخريطة"]})]})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"font-bold text-lg text-black mb-2",children:"الطرف الأول (المالك):"}),e.jsx("p",{className:"text-black",children:"شركة البعد العالي للتجارة، س.ت: 1208502، ومقرها ولاية السيب، هاتف: ٩٣٠٩٩٩١٤."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"font-bold text-lg text-black mb-2",children:"الطرف الثاني (المستأجر):"}),e.jsxs("p",{className:"text-black",children:[s.customer_type==="COMPANY"?"شركة / مؤسسة":"فرد",":"," ",s.customer_name]}),s.customer_commercial_record&&e.jsxs("p",{className:"text-black mt-1",children:["س.ت: ",s.customer_commercial_record]}),s.customer_id_number&&e.jsxs("p",{className:"text-black mt-1",children:["رقم الهوية: ",s.customer_id_number]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-black",children:e.jsx("span",{children:"ويمثلها في هذا العقد:"})}),e.jsx("p",{className:"text-black",children:e.jsx("span",{children:"بصفته:"})})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"font-bold text-lg text-black mb-2",children:"مقدمة:"}),e.jsx("p",{className:"text-black",children:"الطرف الأول منشأة تمتلك عدد من المعدات، وقد أبدى الطرف الثاني رغبته في استئجار عدد منها بغرض الانتفاع بها لفترة زمنية محددة، وقد اتفق الطرفان على ما يلي:"})]}),s.rental_details&&s.rental_details.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-lg font-bold mb-4 text-black",children:"أولاً: بموجب هذا العقد التزم المالك (الطرف الأول) بتأجير عدد من المعدات للمستأجر (الطرف الثاني) والمبينة أوصافها فيما يلي:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-2 border-black",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white border-2 border-black",children:[e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"م"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"النوع"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"العدد"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"تاريخ الإيجار"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"تاريخ الإرجاع"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"المدة"}),e.jsx("th",{className:"border-2 border-black p-3 text-center font-bold text-black",children:"قيمة الإيجار"})]})}),e.jsx("tbody",{children:s.rental_details.map((r,l)=>{const k=D(r.start_date,r.end_date);return e.jsxs("tr",{className:"border-2 border-black",children:[e.jsx("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:l+1}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:r.item_description}),e.jsx("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:r.quantity}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:m(r.start_date)}),e.jsx("td",{className:"border-2 border-black p-3 text-center text-black",children:m(r.end_date)}),e.jsxs("td",{className:"border-2 border-black p-3 text-center font-semibold text-black",children:[k," يوم"]}),e.jsxs("td",{className:"border-2 border-black p-3 text-center font-bold text-black",children:[r.total.toLocaleString()," ر.ع"]})]},r.id)})})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"font-bold text-lg text-black mb-2",children:"ثانياً: مكان الاتفاق:"}),e.jsx("p",{className:"text-black",children:s.delivery_address||"مسقط، سلطنة عمان"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"font-bold text-lg text-black mb-2",children:"ثالثاً: مدة العقد:"}),e.jsx("p",{className:"text-black",children:"مدة هذا العقد تبدأ من تاريخ إستلام المستأجر للمعدات الموضحة في العقد، وتتجدد تلقائياً لفترة مماثلة بعد انقضاء مدة العقد الأصلية في حالة عدم إرجاع المعدات وعدم الإخطار، وفي هذه الحالة يحق للطرف الأول تحديد سعر إيجار جديد بعد انتهاء هذا العقد."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"font-bold text-lg text-black mb-2",children:"رابعاً: التزامات المستأجر:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-black pr-4",children:[e.jsx("li",{children:"يلتزم المستأجر بتمكين المؤجر أو من يمثله بمعاينة المعدات المؤجرة وتفقدها وصيانتها في أى وقت أو سحبها ونقلها في حال تخلف المستأجر عن سداد قيمة الإيجار مقدماً أو الإخلال بشروط العقد دون أن يتحمل أي مسئولية نتيجة الضرر الناتج عن سحب المعدات أو فكها من الموقع ويعد هذا الشرط بمثابة الإخطار المسبق للمستأجر."}),e.jsx("li",{children:"يقر المستأجر بأنه قد عاين المعدات المؤجرة معاينة نافية للجهالة وقبلها بحالتها الراهنة، وأنها صالحة للإستعمال."}),e.jsx("li",{children:"إذا تسبب المستأجر في فقد المعدة أو تلفها كلياً أو جزئياً بفعله أو بفعل الغير يلتزم بتعويض المالك بقيمتها حسب الشراء."}),e.jsx("li",{children:"جميع العقود المبرمة حول الكميات المستأجرة يتم إعادة إحتساب قيمة إيجارية أخرى في حالة إرجاع جزء منها بعقد جديد ولا ينطبق سعر الإيجار على أي إتفاق آخر خارج عن هذا العقد، ويحدد الطرف الأول (المؤجر) القيمة الإيجارية الجديدة."}),e.jsx("li",{children:"يحق للمالك تحديد قيمة إيجارية جديدة حسب رؤيته بعد إنتهاء هذا العقد أو التجديد التلقائي ويعد هذا الشرط بمثابة الإخطار المسبق للمستأجر."}),e.jsx("li",{children:"يقر الطرف الثاني (المستأجر) بتخويل أى شخص يعمل لديه باستلام المعدات وتسليمها."}),e.jsx("li",{children:"لا يعتد بأى إدعاء حول إرجاع المعدات ما لم يقدم المستأجر ما يفيد ذلك كتابياً موقعاً من طرف المؤجر."})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"font-bold text-lg text-black mb-2",children:"خامساً: الفصل في النزاع:"}),e.jsx("p",{className:"text-black",children:"أي نزاع قد ينشأ عن تنفيذ هذا العقد أو تفسير نصوصه إن لم يتم حسمه بالتراضي يتم الفصل فيه لدى الجهات القضائية والمحاكم المختصة بولاية السيب وفي حالة وجود بند غير واضح يفسر لصالح المؤجر ويستمر إحتساب القيمة الإيجارية لحين إرجاع المعدات."})]})]}),f?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center print-container print-break",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full inline-block mb-4",children:e.jsx(X,{className:"h-8 w-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"تم التوقيع بنجاح!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"شكراً لتوقيعك على العقد"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 print-container print-break",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"التوقيع على العقد"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"تعليمات التوقيع"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"يرجى مراجعة تفاصيل العقد أعلاه والتوقيع إلكترونياً في المنطقة أدناه. هذا التوقيع له نفس القوة القانونية للتوقيع اليدوي."})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mt-12 pt-8 border-t-2 border-black",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b-2 border-black w-48 mx-auto mb-2 h-16"})}),e.jsx("p",{className:"font-bold text-lg text-black",children:"توقيع الطرف الأول (المؤجر)"}),e.jsx("p",{className:"text-sm text-black mt-2",children:"شركة البعد العالي للتجارة"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"border-2 border-dashed border-[#58d2c8] rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"توقيع العميل"}),e.jsx("p",{className:"text-sm text-gray-600",children:"اضغط واسحب للتوقيع في المنطقة أدناه"})]}),e.jsx("div",{className:"w-full",children:e.jsx(J,{onSignatureComplete:_,onSignatureClear:()=>{u(""),h(!1)},width:300,height:120,strokeColor:"#000000",strokeWidth:2})})]})}),e.jsx("p",{className:"font-bold text-lg text-black",children:"توقيع الطرف الثاني (المستأجر)"}),e.jsx("p",{className:"text-sm text-black mt-2",children:s.customer_name})]})]}),w&&e.jsxs("div",{className:"mt-6 text-center",children:[e.jsxs(E,{onClick:S,disabled:v,className:"px-8 py-3 bg-[#58d2c8] hover:bg-[#4AB8B3] disabled:bg-gray-400 text-white rounded-lg transition-colors flex items-center gap-2 mx-auto",children:[e.jsx(X,{className:"h-5 w-5"}),v?"جاري حفظ التوقيع...":"حفظ التوقيع"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"اضغط لحفظ التوقيع والانتقال للصفحة التالية"})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-black text-center text-sm text-black print-break",children:[e.jsxs("p",{className:"mb-1",children:["رقم العقد: ",e.jsx("span",{className:"font-semibold",children:b})]}),e.jsxs("p",{children:["تاريخ الإصدار: ",e.jsx("span",{className:"font-semibold",children:m(s.contract_date)})]})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500 print-break",children:[e.jsx("p",{children:"شركة البعد العالي للتجارة - جميع الحقوق محفوظة"}),e.jsx("p",{children:"هذا التوقيع الإلكتروني محمي ومؤمن"})]})]})})]})}export{ne as default};
