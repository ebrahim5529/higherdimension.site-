import{u as E,r as o,j as e,H as $,a as b}from"./app-DC70pVjm.js";import{D as q,P as H}from"./DashboardLayout-hjp-9ivh.js";import{C as w,b as S,c as C,a as k}from"./card-DdBhtchT.js";import{B as x}from"./button-CCsAHJj1.js";import{I as n}from"./input-DMs8wDeE.js";import{L as p}from"./label-vs7EW7ob.js";import{s as _}from"./use-toast-weOckxar.js";import{A as P}from"./arrow-right-ceDhKCR-.js";import{T as M}from"./trash-2-C7a61DKz.js";import{S as z}from"./save-B12NfqSq.js";/* empty css            */import"./createLucideIcon-gXsaNq4V.js";import"./triangle-alert-Dwooo7My.js";import"./file-text-j4Qn0fru.js";import"./eye-DDqfhxOU.js";import"./shield-5CH0y752.js";import"./circle-alert-CnKodfJj.js";import"./map-pin-BBAWf8o9.js";import"./mail-BERZcaE2.js";function le({entry:a,accounts:D}){const{errors:f}=E().props,[y,F]=o.useState(a.date.split("T")[0]),[N,R]=o.useState(a.description),[h,T]=o.useState(a.reference_type||""),[u,A]=o.useState(a.reference_id?String(a.reference_id):""),[i,j]=o.useState(a.items.map(t=>({account_id:String(t.account_id),debit:String(t.debit),credit:String(t.credit),description:t.description||""}))),I=()=>{j([...i,{account_id:"",debit:"",credit:"",description:""}])},L=t=>{i.length<=2||j(i.filter((s,r)=>r!==t))},c=(t,s,r)=>{const l=[...i];l[t]={...l[t],[s]:r},s==="debit"&&parseFloat(r)>0?l[t].credit="0":s==="credit"&&parseFloat(r)>0&&(l[t].debit="0"),j(l)},d=i.reduce((t,s)=>t+(parseFloat(s.debit)||0),0),g=i.reduce((t,s)=>t+(parseFloat(s.credit)||0),0),m=Math.abs(d-g)<.01,v=d-g,B=t=>{if(t.preventDefault(),!m){_.error("خطأ","إجمالي المدين يجب أن يساوي إجمالي الدائن");return}const s=i.filter(r=>r.account_id).map(r=>({account_id:Number(r.account_id),debit:parseFloat(r.debit)||0,credit:parseFloat(r.credit)||0,description:r.description||null}));if(s.length<2){_.error("خطأ","يجب إضافة بندين على الأقل");return}b.put(`/accounting/journal-entries/${a.id}`,{date:y,description:N,reference_type:h||null,reference_id:u?Number(u):null,items:s})};return e.jsxs(q,{children:[e.jsx($,{title:`تعديل قيد ${a.entry_number}`}),e.jsxs("div",{className:"space-y-6 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{variant:"ghost",onClick:()=>b.visit(`/accounting/journal-entries/${a.id}`),className:"p-2",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["تعديل قيد ",a.entry_number]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"تعديل بيانات وبنود القيد المحاسبي"})]})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs(w,{className:"mb-6",children:[e.jsx(S,{children:e.jsx(C,{children:"بيانات القيد"})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"التاريخ *"}),e.jsx(n,{type:"date",value:y,onChange:t=>F(t.target.value),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(p,{children:"الوصف *"}),e.jsx(n,{value:N,onChange:t=>R(t.target.value),placeholder:"وصف القيد المحاسبي",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{children:"نوع المرجع"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm",value:h,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"",children:"بدون مرجع"}),e.jsx("option",{value:"payment",children:"دفعة"}),e.jsx("option",{value:"contract",children:"عقد"}),e.jsx("option",{value:"salary",children:"راتب"}),e.jsx("option",{value:"purchase",children:"مشتريات"}),e.jsx("option",{value:"other",children:"أخرى"})]})]}),h&&e.jsxs("div",{children:[e.jsx(p,{children:"رقم المرجع"}),e.jsx(n,{value:u,onChange:t=>A(t.target.value),placeholder:"رقم المرجع"})]})]})})]}),e.jsxs(w,{className:"mb-6",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{children:"بنود القيد"}),e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:I,className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-4 w-4"}),"إضافة بند"]})]})}),e.jsxs(k,{children:[f?.items&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 text-sm",children:f.items}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-500 w-8",children:"#"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-500 min-w-[250px]",children:"الحساب"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-500 w-[150px]",children:"مدين"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-500 w-[150px]",children:"دائن"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-500 min-w-[200px]",children:"ملاحظة"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{children:i.map((t,s)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 text-gray-400",children:s+1}),e.jsx("td",{className:"py-2 px-2",children:e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-2 py-1.5 text-sm",value:t.account_id,onChange:r=>c(s,"account_id",r.target.value),required:!0,children:[e.jsx("option",{value:"",children:"اختر الحساب"}),D.map(r=>e.jsxs("option",{value:r.id,children:[r.code," - ",r.name]},r.id))]})}),e.jsx("td",{className:"py-2 px-2",children:e.jsx(n,{type:"number",step:"0.01",min:"0",value:t.debit,onChange:r=>c(s,"debit",r.target.value),placeholder:"0.00",className:"text-left font-mono"})}),e.jsx("td",{className:"py-2 px-2",children:e.jsx(n,{type:"number",step:"0.01",min:"0",value:t.credit,onChange:r=>c(s,"credit",r.target.value),placeholder:"0.00",className:"text-left font-mono"})}),e.jsx("td",{className:"py-2 px-2",children:e.jsx(n,{value:t.description,onChange:r=>c(s,"description",r.target.value),placeholder:"ملاحظة اختيارية"})}),e.jsx("td",{className:"py-2 px-2",children:i.length>2&&e.jsx("button",{type:"button",onClick:()=>L(s),className:"p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/30",children:e.jsx(M,{className:"h-4 w-4 text-red-500"})})})]},s))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{colSpan:2,className:"py-3 px-2 text-left",children:"الإجمالي"}),e.jsx("td",{className:"py-3 px-2 font-mono text-left",children:d.toLocaleString("ar-SA",{minimumFractionDigits:2})}),e.jsx("td",{className:"py-3 px-2 font-mono text-left",children:g.toLocaleString("ar-SA",{minimumFractionDigits:2})}),e.jsxs("td",{colSpan:2,className:"py-3 px-2",children:[!m&&d>0&&e.jsxs("span",{className:"text-red-500 text-sm font-normal",children:["الفرق: ",Math.abs(v).toLocaleString("ar-SA",{minimumFractionDigits:2}),v>0?" (مدين أكثر)":" (دائن أكثر)"]}),m&&d>0&&e.jsx("span",{className:"text-green-500 text-sm font-normal",children:"متوازن ✓"})]})]})})]})})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>b.visit(`/accounting/journal-entries/${a.id}`),children:"إلغاء"}),e.jsxs(x,{type:"submit",className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",disabled:!m||d===0,children:[e.jsx(z,{className:"h-4 w-4"}),"حفظ التعديلات"]})]})]})]})]})}export{le as default};
