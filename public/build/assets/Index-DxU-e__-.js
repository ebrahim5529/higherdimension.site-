import{j as e,a as o,u as S,H as F,r as h}from"./app-CSCnDOL8.js";import{C as P,S as y,P as j,d as D,D as T}from"./DashboardLayout-BtxHxH26.js";import{C as A,b as L,c as M,a as $}from"./card-BRpxhRQK.js";import{F as g,D as I,U as N,C as w}from"./user-Bic5WbAP.js";import{C as R}from"./circle-check-big-DVLQ_mZE.js";import{B as p}from"./button-D02rIfzJ.js";import{I as b}from"./input-uyGVjKtO.js";import{F as f}from"./filter-DGcb4LpD.js";import{E as k}from"./eye-CWbNWa5x.js";import{s as u}from"./use-toast-qNO1wWiP.js";/* empty css            */function _({stats:s}){const x=s.totalAmount>0?Math.round(s.totalPaid/s.totalAmount*100):0;s.totalAmount>0&&Math.round(s.totalRemaining/s.totalAmount*100);const i=[{title:"إجمالي العقود",value:s.totalContracts,icon:g,color:"text-blue-600",bgColor:"bg-blue-100",change:`${s.fullyPaidContracts} مدفوع بالكامل`,changeType:"positive"},{title:"إجمالي المبلغ",value:new Intl.NumberFormat("ar-SA",{style:"currency",currency:"OMR",minimumFractionDigits:2,maximumFractionDigits:2}).format(s.totalAmount),icon:I,color:"text-green-600",bgColor:"bg-green-100",change:`${x}% مدفوع`,changeType:"positive"},{title:"المبلغ المدفوع",value:new Intl.NumberFormat("ar-SA",{style:"currency",currency:"OMR",minimumFractionDigits:2,maximumFractionDigits:2}).format(s.totalPaid),icon:R,color:"text-emerald-600",bgColor:"bg-emerald-100",change:`${s.partiallyPaidContracts} مدفوع جزئياً`,changeType:"positive"},{title:"المبلغ المتبقي",value:new Intl.NumberFormat("ar-SA",{style:"currency",currency:"OMR",minimumFractionDigits:2,maximumFractionDigits:2}).format(s.totalRemaining),icon:P,color:"text-orange-600",bgColor:"bg-orange-100",change:`${s.unpaidContracts} غير مدفوع`,changeType:"negative"}];return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:i.map((r,n)=>{const l=r.icon;return e.jsxs(A,{className:"hover:shadow-lg transition-shadow duration-200",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(M,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:r.title}),e.jsx("div",{className:`p-2 rounded-lg ${r.bgColor}`,children:e.jsx(l,{className:`h-5 w-5 ${r.color}`})})]}),e.jsxs($,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.value}),e.jsx("p",{className:`text-xs mt-1 ${r.changeType==="positive"?"text-green-600 dark:text-green-400":r.changeType==="negative"?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:r.change})]})]},n)})})})}function B({contracts:s,onViewContract:x,onAddPayment:i}){const[r,n]=o.useState(""),[l,d]=o.useState("all"),c=s.filter(t=>{const v=t.contractNumber.toLowerCase().includes(r.toLowerCase())||t.customerName.toLowerCase().includes(r.toLowerCase())||t.title.toLowerCase().includes(r.toLowerCase()),C=l==="all"||l==="fully_paid"&&t.paymentStatus==="مدفوع بالكامل"||l==="partially_paid"&&t.paymentStatus==="مدفوع جزئياً"||l==="unpaid"&&t.paymentStatus==="غير مدفوع";return v&&C}),a=t=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"OMR",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),m=t=>{switch(t){case"مدفوع بالكامل":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"مدفوع جزئياً":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"غير مدفوع":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex-1 w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(b,{type:"text",placeholder:"ابحث عن عقد أو عميل...",value:r,onChange:t=>n(t.target.value),className:"pr-10 w-full sm:w-80"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:l,onChange:t=>d(t.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"جميع الحالات"}),e.jsx("option",{value:"fully_paid",children:"مدفوع بالكامل"}),e.jsx("option",{value:"partially_paid",children:"مدفوع جزئياً"}),e.jsx("option",{value:"unpaid",children:"غير مدفوع"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"رقم العقد"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"العميل"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"المبلغ الإجمالي"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"المدفوع"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"المتبقي"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"حالة الدفع"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"آخر دفعة"}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:c.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:[e.jsx(g,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"لا توجد عقود"})]})}):c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.contractNumber})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t.title})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t.customerName})]}),t.customerPhone&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t.customerPhone})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a(t.amount)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:a(t.paidAmount)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t.paymentPercentage.toFixed(1),"%"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:a(t.remainingAmount)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m(t.paymentStatus)}`,children:t.paymentStatus}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t.paymentsCount," دفعة"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.lastPaymentDate?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t.lastPaymentDate})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>x(t),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"عرض العقد",children:e.jsx(k,{className:"h-4 w-4"})}),t.remainingAmount>0&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>i(t),className:"text-green-600 hover:text-green-700 hover:bg-green-50",title:"تسديد دفعة",children:e.jsx(j,{className:"h-4 w-4"})})]})})]},t.id))})]})})]})}function E({payments:s,onViewPayment:x}){const[i,r]=o.useState(""),[n,l]=o.useState("all"),d=s.filter(a=>{const m=a.contractNumber.toLowerCase().includes(i.toLowerCase())||a.customerName.toLowerCase().includes(i.toLowerCase())||a.contractTitle.toLowerCase().includes(i.toLowerCase())||a.checkNumber&&a.checkNumber.toLowerCase().includes(i.toLowerCase()),t=n==="all"||a.paymentMethod===n;return m&&t}),c=a=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"OMR",minimumFractionDigits:2,maximumFractionDigits:2}).format(a);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"جميع المدفوعات"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex-1 w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(b,{type:"text",placeholder:"ابحث عن دفعة أو عقد أو عميل...",value:i,onChange:a=>r(a.target.value),className:"pr-10 w-full sm:w-80"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:n,onChange:a=>l(a.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"جميع الطرق"}),e.jsx("option",{value:"نقداً",children:"نقداً"}),e.jsx("option",{value:"شيك",children:"شيك"}),e.jsx("option",{value:"بطاقة ائتمان",children:"بطاقة ائتمان"}),e.jsx("option",{value:"تحويل بنكي",children:"تحويل بنكي"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"رقم الدفعة"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"رقم العقد"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"العميل"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"طريقة الدفع"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"تاريخ الدفع"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"المبلغ"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"رقم الشيك"}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:d.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:[e.jsx(g,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"لا توجد مدفوعات"})]})}):d.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer",onClick:()=>x(a),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["#",a.id]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.contractNumber})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a.contractTitle})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:a.customerName})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",children:a.paymentMethod})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:a.paymentDate})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:c(a.amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:a.checkNumber||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx(p,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),x(a)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"عرض التفاصيل",children:e.jsx(k,{className:"h-4 w-4"})})})]},a.id))})]})})]})}function X({contracts:s,payments:x,stats:i}){const{flash:r}=S().props;o.useEffect(()=>{r?.success&&u.success("نجح",r.success),r?.error&&u.error("خطأ",r.error)},[r]);const n=c=>{c?h.visit(`/payments/create?contract_id=${c.id}`):h.visit("/payments/create")},l=c=>{h.visit(`/contracts/${c.id}`)},d=c=>{h.visit(`/payments/${c.id}`)};return e.jsxs(T,{children:[e.jsx(F,{title:"إدارة المدفوعات"}),e.jsxs("div",{className:"space-y-6 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"إدارة المدفوعات"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"عرض وإدارة مدفوعات العقود"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(p,{onClick:()=>n(),className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),"تسديد دفعة جديدة"]})})]}),e.jsx(_,{stats:i}),e.jsx(B,{contracts:s,onViewContract:l,onAddPayment:n}),e.jsx(E,{payments:x,onViewPayment:d})]})]})}export{X as default};
