import{u as I,r as x,j as e,H as M,a as v}from"./app-CCHA9ub0.js";import{D as P,P as q,S as A,C as H}from"./DashboardLayout-BHw3dqES.js";import{C as f,a as N,b as C,c as _}from"./card-Bly1X19M.js";import{B as k}from"./button-Bfv0f9vZ.js";import{I as j}from"./input-BoE7gBrx.js";import{L as m}from"./label-FJ4D8Qgc.js";import{s as S}from"./use-toast-CTmzR8DA.js";import{c as O}from"./createLucideIcon-FmD0vq03.js";import{C as T}from"./chevron-left-D5UMBoXI.js";import{P as R}from"./pen-DutBjBja.js";import{T as Z}from"./trash-2-C_sLctUu.js";/* empty css            */import"./triangle-alert-DWFl2Smt.js";import"./file-text-CauxPHHp.js";import"./eye-8DxskOvD.js";import"./shield-CQHunxOJ.js";import"./circle-alert-CjQBNfBa.js";import"./map-pin-DHI_P5OF.js";import"./mail-9UAeJwq9.js";const L=O("FolderTree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]),w={asset:"أصول",liability:"التزامات",equity:"حقوق ملكية",revenue:"إيرادات",expense:"مصروفات"},D={asset:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",liability:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",equity:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",revenue:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",expense:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300"};function E({account:t,onEdit:o,onDelete:n,searchTerm:a}){const[p,y]=x.useState(!0),c=t.children_recursive&&t.children_recursive.length>0,i=!a||t.name.toLowerCase().includes(a.toLowerCase())||t.code.includes(a),h=s=>s.name.toLowerCase().includes(a.toLowerCase())||s.code.includes(a)?!0:(s.children_recursive||[]).some(h);return a&&!i&&!h(t)?null:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 py-2 px-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group ${t.is_active?"":"opacity-50"}`,style:{paddingRight:`${t.level*24+12}px`},children:[c?e.jsx("button",{onClick:()=>y(!p),className:"p-0.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700",children:p?e.jsx(H,{className:"h-4 w-4 text-gray-500"}):e.jsx(T,{className:"h-4 w-4 text-gray-500"})}):e.jsx("span",{className:"w-5"}),e.jsx("span",{className:"font-mono text-sm text-gray-500 dark:text-gray-400 min-w-[60px]",children:t.code}),e.jsx("span",{className:`flex-1 text-sm ${t.is_parent?"font-bold text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-300"}`,children:t.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${D[t.type]}`,children:w[t.type]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>o(t),className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700",children:e.jsx(R,{className:"h-3.5 w-3.5 text-gray-500"})}),!t.is_parent&&e.jsx("button",{onClick:()=>n(t.id),className:"p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/30",children:e.jsx(Z,{className:"h-3.5 w-3.5 text-red-500"})})]})]}),c&&p&&e.jsx("div",{children:t.children_recursive.map(s=>e.jsx(E,{account:s,onEdit:o,onDelete:n,searchTerm:a},s.id))})]})}function oe({accounts:t,flatAccounts:o}){const{flash:n}=I().props,[a,p]=x.useState(""),[y,c]=x.useState(!1),[i,h]=x.useState(null),[s,l]=x.useState({code:"",name:"",parent_id:"",type:"asset",description:"",is_parent:!1});x.useEffect(()=>{n?.success&&S.success("نجح",n.success),n?.error&&S.error("خطأ",n.error)},[n]);const g=()=>{l({code:"",name:"",parent_id:"",type:"asset",description:"",is_parent:!1}),h(null),c(!1)},$=r=>{h(r),l({code:r.code,name:r.name,parent_id:r.parent_id?String(r.parent_id):"",type:r.type,description:r.description||"",is_parent:r.is_parent}),c(!0)},B=r=>{confirm("هل أنت متأكد من حذف هذا الحساب؟")&&v.delete(`/accounting/chart-of-accounts/${r}`)},F=r=>{r.preventDefault();const d={...s,parent_id:s.parent_id?Number(s.parent_id):null};i?v.put(`/accounting/chart-of-accounts/${i.id}`,d,{onSuccess:()=>g()}):v.post("/accounting/chart-of-accounts",d,{onSuccess:()=>g()})};return o.filter(r=>r.is_parent||r.children_recursive?.length),e.jsxs(P,{children:[e.jsx(M,{title:"شجرة الحسابات"}),e.jsxs("div",{className:"space-y-6 mt-2 -mx-1 sm:-mx-2 lg:-mx-3 xl:-mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"شجرة الحسابات"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"إدارة الحسابات المحاسبية وتنظيمها بشكل هرمي"})]}),e.jsxs(k,{onClick:()=>{g(),c(!0)},className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"إضافة حساب"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(w).map(([r,d])=>{const u=o.filter(b=>b.type===r).length;return e.jsx(f,{children:e.jsxs(N,{className:"p-4 text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${D[r].split(" ")[1]}`,children:u}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:d})]})},r)})}),y&&e.jsxs(f,{children:[e.jsx(C,{children:e.jsx(_,{children:i?"تعديل حساب":"إضافة حساب جديد"})}),e.jsx(N,{children:e.jsxs("form",{onSubmit:F,className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"رمز الحساب"}),e.jsx(j,{value:s.code,onChange:r=>l({...s,code:r.target.value}),placeholder:"مثال: 1110",required:!0,disabled:!!i})]}),e.jsxs("div",{children:[e.jsx(m,{children:"اسم الحساب"}),e.jsx(j,{value:s.name,onChange:r=>l({...s,name:r.target.value}),placeholder:"اسم الحساب",required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{children:"الحساب الأب"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm",value:s.parent_id,onChange:r=>{const d=r.target.value,u=o.find(b=>b.id===Number(d));l({...s,parent_id:d,type:u?u.type:s.type})},disabled:!!i,children:[e.jsx("option",{value:"",children:"بدون (حساب رئيسي)"}),o.filter(r=>r.is_parent).map(r=>e.jsxs("option",{value:r.id,children:[r.code," - ",r.name]},r.id))]})]}),!s.parent_id&&e.jsxs("div",{children:[e.jsx(m,{children:"نوع الحساب"}),e.jsx("select",{className:"w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm",value:s.type,onChange:r=>l({...s,type:r.target.value}),disabled:!!i,children:Object.entries(w).map(([r,d])=>e.jsx("option",{value:r,children:d},r))})]}),e.jsxs("div",{children:[e.jsx(m,{children:"الوصف"}),e.jsx(j,{value:s.description,onChange:r=>l({...s,description:r.target.value}),placeholder:"وصف اختياري"})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.is_parent,onChange:r=>l({...s,is_parent:r.target.checked}),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm",children:"حساب رئيسي (تجميعي)"})]})}),e.jsxs("div",{className:"md:col-span-3 flex gap-2 justify-end",children:[e.jsx(k,{type:"button",variant:"outline",onClick:g,children:"إلغاء"}),e.jsx(k,{type:"submit",className:"bg-[#58d2c8] hover:bg-[#4AB8B3] text-white",children:i?"تحديث":"إضافة"})]})]})})]}),e.jsxs(f,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"شجرة الحسابات"]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(A,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(j,{placeholder:"بحث بالاسم أو الرمز...",value:a,onChange:r=>p(r.target.value),className:"pr-9"})]})]})}),e.jsx(N,{children:t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(L,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد حسابات بعد. قم بإضافة حسابات أو تشغيل Seeder."})]}):e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:t.map(r=>e.jsx(E,{account:r,onEdit:$,onDelete:B,searchTerm:a},r.id))})})]})]})]})}export{oe as default};
