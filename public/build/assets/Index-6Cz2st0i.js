import{u as J,a as i,b as O,j as e,H as Q,r as V}from"./app-CgSVc5Wn.js";import{D as X,g as y,P as Y,K as Z}from"./DashboardLayout-BIO_sjjx.js";import{B as l}from"./button-BGcazaoI.js";import{I as P}from"./input-CkIX0MbD.js";import{D as $,b as ee,a as E,c as F,d as H,e as R,f as _}from"./dialog-ptjPhv06.js";import{T as se,a as ae,b as w,c as x,d as ne,e as d}from"./table-CflWPYwu.js";import{C as u,b as p,c as j,a as f,d as ce}from"./card-Dywtg_PO.js";import{C as q}from"./checkbox-Bj_7G6kX.js";import{s as g}from"./use-toast-DoooC-Gp.js";import{C as te}from"./confirm-dialog-Cq6yCi9e.js";import{S as le}from"./square-pen-NH67_JDK.js";import{T as re}from"./trash-2-CN_eV5Iq.js";/* empty css            */import"./user-GZG2W0xx.js";import"./eye-Cjz6YKgE.js";import"./index-CBa_YVis.js";import"./check-Bj4NjL_D.js";import"./triangle-alert-BhpvflNV.js";function ke({roles:C,allPermissions:D,stats:v}){const{flash:o}=J().props,[B,b]=i.useState(!1),[L,m]=i.useState(!1),[z,N]=i.useState(!1),[r,h]=i.useState(null),t=O({name:"",permissions:[]}),c=O({name:"",permissions:[]});i.useEffect(()=>{o?.success&&(g.success("نجح",o.success),b(!1),m(!1),t.reset(),c.reset()),o?.error&&g.error("خطأ",o.error)},[o]);const K=()=>{t.post("/roles",{onSuccess:()=>{t.reset()}})},U=a=>{h(a),c.setData({name:a.name,permissions:a.permissions.map(s=>s.id)}),m(!0)},A=()=>{r&&c.put(`/roles/${r.id}`,{onSuccess:()=>{m(!1),h(null),c.reset()}})},I=a=>{h(a),N(!0)},M=()=>{r&&V.delete(`/roles/${r.id}`,{onSuccess:()=>{g.success("تم الحذف بنجاح",`تم حذف الدور "${r.name}" بنجاح`),N(!1),h(null)},onError:a=>{g.error("فشل الحذف",a?.message||"حدث خطأ أثناء حذف الدور")}})},k=(a,s)=>{const n=s.data.permissions||[];n.includes(a)?s.setData("permissions",n.filter(G=>G!==a)):s.setData("permissions",[...n,a])},W={"access-main-dashboard":"الوصول إلى الرئيسية","access-dashboard-reports":"الوصول إلى لوحة التحكم والتقارير","access-dashboard-interactive":"لوحة التحكم التفاعلية","access-financial-reports":"التقارير المالية","access-operations-reports":"تقارير التشغيل والمخزون","access-customer-reports":"تقارير العملاء","access-customers":"الوصول إلى إدارة العملاء","manage-customers":"إدارة بيانات العملاء","view-customer-contracts":"عرض عقود العملاء","manage-customer-claims":"إدارة مطالبات العملاء","access-suppliers":"الوصول إلى إدارة الموردين","manage-suppliers":"إدارة بيانات الموردين","view-supplier-invoices":"عرض فواتير الموردين","manage-supplier-purchases":"إدارة مشتريات الموردين","access-inventory":"الوصول إلى إدارة المخزون","manage-inventory":"إدارة المخزون","purchase-equipment":"شراء معدات جديدة","manage-purchases":"إدارة المشتريات","access-contracts":"الوصول إلى إدارة العقود","manage-contracts":"إدارة العقود والاتفاقيات","view-active-contracts":"عرض العقود النشطة","view-expired-contracts":"عرض العقود المنتهية","view-cancelled-contracts":"عرض العقود الملغاة","access-operations":"الوصول إلى إدارة التشغيل","manage-delivery-orders":"إدارة طلبات التوصيل","track-shipping":"تتبع الشحن","manage-delivery-receipt":"إدارة إيصالات التسليم","manage-return-inspection":"إدارة فحص الاسترجاع","access-financial":"الوصول إلى إدارة المالية","manage-payment-transactions":"إدارة المعاملات المالية","manage-invoices":"إدارة الفواتير","view-financial-reports":"عرض التقارير المالية","access-employees":"الوصول إلى إدارة الموظفين","manage-employees":"إدارة بيانات الموظفين","manage-salaries":"إدارة الرواتب","manage-incentives":"إدارة الحوافز","manage-attendance":"إدارة الحضور والانصراف","manage-departments":"إدارة الأقسام","manage-leaves":"إدارة الإجازات","access-permissions":"الوصول إلى إدارة الصلاحيات","manage-user-roles":"إدارة أدوار المستخدمين","manage-permission-groups":"إدارة مجموعات الصلاحيات","manage-roles":"إدارة الأدوار","access-payments":"الوصول إلى المدفوعات","view-all-payments":"عرض جميع المدفوعات","view-late-payments":"عرض المدفوعات المتأخرة","view-payment-reports":"عرض تقارير المدفوعات","access-settings":"الوصول إلى الإعدادات","manage-electronic-signature":"إدارة التوقيع الإلكتروني"},S=i.useMemo(()=>{const a={الرئيسية:[],"لوحة التحكم والتقارير":[],"إدارة العملاء":[],"إدارة الموردين":[],"إدارة المخزون":[],"إدارة العقود والاتفاقيات":[],"إدارة التشغيل والنقليات":[],"إدارة المالية":[],"إدارة الموظفين":[],"إدارة الصلاحيات":[],المدفوعات:[],الإعدادات:[]};return D.forEach(s=>{s.name.startsWith("access-main-dashboard")?a.الرئيسية.push(s):s.name.includes("dashboard")||s.name.includes("reports")?a["لوحة التحكم والتقارير"].push(s):s.name.includes("customer")?a["إدارة العملاء"].push(s):s.name.includes("supplier")?a["إدارة الموردين"].push(s):s.name.includes("inventory")||s.name.includes("purchase-equipment")||s.name.includes("purchases")?a["إدارة المخزون"].push(s):s.name.includes("contract")?a["إدارة العقود والاتفاقيات"].push(s):s.name.includes("operation")||s.name.includes("delivery")||s.name.includes("shipping")||s.name.includes("return")?a["إدارة التشغيل والنقليات"].push(s):s.name.includes("financial")||s.name.includes("invoice")||s.name.includes("payment-transaction")?a["إدارة المالية"].push(s):s.name.includes("employee")||s.name.includes("salary")||s.name.includes("incentive")||s.name.includes("attendance")||s.name.includes("department")||s.name.includes("leave")?a["إدارة الموظفين"].push(s):s.name.includes("permission")||s.name.includes("role")||s.name.includes("user-role")?a["إدارة الصلاحيات"].push(s):s.name.includes("payment")&&!s.name.includes("transaction")?a.المدفوعات.push(s):(s.name.includes("setting")||s.name.includes("electronic-signature"))&&a.الإعدادات.push(s)}),a},[D]),T=a=>W[a]||a.replace(/-/g," ");return e.jsxs(X,{children:[e.jsx(Q,{title:"إدارة الأدوار"}),e.jsxs("div",{className:"w-full space-y-6 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-xl font-semibold",children:"إدارة الأدوار"})]}),e.jsxs($,{open:B,onOpenChange:b,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(Y,{className:"h-4 w-4"}),"إضافة دور جديد"]})}),e.jsxs(E,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(F,{children:[e.jsx(H,{children:"إضافة دور جديد"}),e.jsx(R,{children:"قم بإنشاء دور جديد وتعيين الصلاحيات له"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"اسم الدور"}),e.jsx(P,{value:t.data.name,onChange:a=>t.setData("name",a.target.value),placeholder:"مثال: مدير، محرر، مشاهد"}),t.errors.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.errors.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الصلاحيات"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto space-y-4",children:Object.entries(S).map(([a,s])=>s.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm text-primary border-b pb-1",children:a}),e.jsx("div",{className:"space-y-2 pr-4",children:s.map(n=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(q,{id:`create-permission-${n.id}`,checked:t.data.permissions?.includes(n.id),onCheckedChange:()=>k(n.id,t)}),e.jsx("label",{htmlFor:`create-permission-${n.id}`,className:"text-sm cursor-pointer",children:T(n.name)})]},n.id))})]},a))}),t.errors.permissions&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.errors.permissions})]})]}),e.jsxs(_,{children:[e.jsx(l,{variant:"outline",onClick:()=>b(!1),children:"إلغاء"}),e.jsx(l,{onClick:K,disabled:t.processing,children:t.processing?"جاري الحفظ...":"حفظ"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"إجمالي الأدوار"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalRoles})})]}),e.jsxs(u,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"إجمالي الصلاحيات"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalPermissions})})]}),e.jsxs(u,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"إجمالي المستخدمين"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:v.totalUsers})})]})]}),e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsx(j,{children:"قائمة الأدوار"}),e.jsx(ce,{children:"إدارة جميع الأدوار والصلاحيات في النظام"})]}),e.jsx(f,{children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(w,{children:[e.jsx(x,{children:"اسم الدور"}),e.jsx(x,{children:"عدد الصلاحيات"}),e.jsx(x,{children:"عدد المستخدمين"}),e.jsx(x,{children:"تاريخ الإنشاء"}),e.jsx(x,{className:"text-left",children:"الإجراءات"})]})}),e.jsx(ne,{children:C.length===0?e.jsx(w,{children:e.jsx(d,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"لا توجد أدوار"})}):C.map(a=>e.jsxs(w,{children:[e.jsx(d,{className:"font-medium",children:a.name}),e.jsx(d,{children:a.permissions_count}),e.jsx(d,{children:a.users_count}),e.jsx(d,{children:new Date(a.created_at).toLocaleDateString("ar-SA")}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>U(a),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>I(a),children:e.jsx(re,{className:"h-4 w-4 text-red-500"})})]})})]},a.id))})]})})]}),e.jsx($,{open:L,onOpenChange:m,children:e.jsxs(E,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(F,{children:[e.jsx(H,{children:"تعديل الدور"}),e.jsx(R,{children:"قم بتعديل الدور وتعيين الصلاحيات"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"اسم الدور"}),e.jsx(P,{value:c.data.name,onChange:a=>c.setData("name",a.target.value),placeholder:"مثال: مدير، محرر، مشاهد"}),c.errors.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.errors.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"الصلاحيات"}),e.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto space-y-4",children:Object.entries(S).map(([a,s])=>s.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm text-primary border-b pb-1",children:a}),e.jsx("div",{className:"space-y-2 pr-4",children:s.map(n=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(q,{id:`edit-permission-${n.id}`,checked:c.data.permissions?.includes(n.id),onCheckedChange:()=>k(n.id,c)}),e.jsx("label",{htmlFor:`edit-permission-${n.id}`,className:"text-sm cursor-pointer",children:T(n.name)})]},n.id))})]},a))}),c.errors.permissions&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.errors.permissions})]})]}),e.jsxs(_,{children:[e.jsx(l,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),e.jsx(l,{onClick:A,disabled:c.processing,children:c.processing?"جاري الحفظ...":"حفظ"})]})]})}),e.jsx(te,{open:z,onOpenChange:N,onConfirm:M,title:"حذف الدور",description:`هل أنت متأكد من حذف الدور "${r?.name}"؟`})]})]})}export{ke as default};
