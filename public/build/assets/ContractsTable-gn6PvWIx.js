import{r as o,j as e}from"./app-D5GchK2n.js";import{u as R,g as F,a as M,b as P,c as B,f as D}from"./index-DHkqPjuo.js";import{C as h,a as K,b as A,d as p}from"./card-J0aNvoEZ.js";import{B as T}from"./button-CjRbmYRh.js";import{U as J,a as O,c as Q,R as W,P as L,S as X,d as $,e as G}from"./DashboardLayout-BTosQ__p.js";import{G as Y}from"./git-branch-78hRuf6L.js";import{E as Z}from"./eye-IupIiIID.js";import{S as I}from"./square-pen-Co6JDyxF.js";import{P as ee}from"./printer-Bk2blCxa.js";import{T as te}from"./trash-2-D3-QzUxF.js";function xe({data:l,onAddContract:b,onEditContract:j,onDeleteContract:N,onViewContract:f,onViewStages:i,onPrint:d,onIssueInvoice:m,isLoading:V=!1}){const[y,w]=o.useState([]),[k,C]=o.useState([]),[r,g]=o.useState(""),[x,se]=o.useState("all"),E=t=>{switch(t){case"عقود مفتوحة":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"عقود مغلقة":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400";case"عقود مغلقة ولم يتم استلام الأصناف":return"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400";default:return"bg-gray-100 text-gray-800"}},H=l.filter(t=>t.status==="عقود مفتوحة"),U=l.filter(t=>t.status==="عقود مغلقة ولم يتم استلام الأصناف"),_=l.filter(t=>t.status==="عقود مغلقة"),u=(t,s,n,z)=>{if(t.length===0)return null;const S=R({data:t,columns:v,getCoreRowModel:B(),getFilteredRowModel:P(),getSortedRowModel:M(),getPaginationRowModel:F(),onSortingChange:w,onColumnFiltersChange:C,onGlobalFilterChange:g,state:{sorting:y,columnFilters:k,globalFilter:r}});return e.jsxs(h,{className:`mb-6 ${z}`,children:[e.jsx(K,{className:`${n} border-b`,children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),s," (",t.length,")"]})}),e.jsx(p,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:S.getHeaderGroups().map(c=>e.jsx("tr",{children:c.headers.map(a=>e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a.isPlaceholder?null:e.jsxs("div",{className:"cursor-pointer select-none flex items-center gap-1",onClick:a.column.getToggleSortingHandler(),children:[D(a.column.columnDef.header,a.getContext()),{asc:e.jsx(G,{className:"h-4 w-4 rotate-90"}),desc:e.jsx(G,{className:"h-4 w-4 -rotate-90"})}[a.column.getIsSorted()]??null]})},a.id))},c.id))}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:S.getRowModel().rows.map(c=>e.jsx("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50",children:c.getVisibleCells().map(a=>e.jsx("td",{className:"py-3 px-2 sm:px-4",children:D(a.column.columnDef.cell,a.getContext())},a.id))},c.id))})]})})})]},s)},q=o.useMemo(()=>l.filter(t=>{const s=t.customerName.toLowerCase().includes(r.toLowerCase())||t.contractNumber.toLowerCase().includes(r.toLowerCase())||t.status.toLowerCase().includes(r.toLowerCase()),n=x==="all"||t.status===x;return s&&n}),[l,r,x]),v=o.useMemo(()=>[{accessorKey:"contractNumber",header:"رقم العقد",cell:({row:t})=>{const s=t.getValue("contractNumber");return e.jsx("a",{href:`/contract/sign/${s}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-[#58d2c8] hover:text-[#4AB8B3] hover:underline transition-colors cursor-pointer",onClick:n=>{n.preventDefault(),window.open(`/contract/sign/${s}`,"_blank")},children:s})}},{accessorKey:"customerName",header:"العميل",cell:({row:t})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:t.getValue("customerName")})]})},{accessorKey:"customerPhone",header:"رقم الجوال",cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-gray-900 dark:text-white",children:t.getValue("customerPhone")||"-"})})},{accessorKey:"totalAfterDiscount",header:"الإجمالي",cell:({row:t})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Number(t.getValue("totalAfterDiscount")).toFixed(2)," ر.ع"]})]})},{accessorKey:"totalPayments",header:"المدفوع",cell:({row:t})=>e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:[Number(t.getValue("totalPayments")).toFixed(2)," ر.ع"]})},{accessorKey:"remainingAmount",header:"المتبقي",cell:({row:t})=>{const s=Number(t.getValue("remainingAmount"));return e.jsxs("span",{className:`font-medium ${s>0?"text-orange-600 dark:text-orange-400":"text-green-600 dark:text-green-400"}`,children:[s.toFixed(2)," ر.ع"]})}},{accessorKey:"status",header:"الحالة",cell:({row:t})=>{const s=t.getValue("status");return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${E(s)}`,children:s})}},{accessorKey:"startDate",header:"التواريخ",cell:({row:t})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:["من: ",t.original.startDate]}),e.jsxs("div",{children:["إلى: ",t.original.endDate]})]})]})},{id:"actions",header:"الإجراءات",cell:({row:t})=>{const s=t.original;return e.jsx("div",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsx("button",{onClick:()=>i(s),className:"text-purple-600 hover:text-purple-700 transition-colors p-1",title:"عرض المراحل",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>f(s),className:"text-[#58d2c8] hover:text-[#4AB8B3] transition-colors p-1",title:"عرض التفاصيل",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j(s),className:"text-blue-600 hover:text-blue-700 transition-colors p-1",title:"تعديل",children:e.jsx(I,{className:"h-4 w-4"})}),d&&e.jsx("button",{onClick:()=>d(s),className:"text-green-600 hover:text-green-700 transition-colors p-1",title:"طباعة",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>N(s),className:"text-red-600 hover:text-red-700 transition-colors p-1",title:"حذف",children:e.jsx(te,{className:"h-4 w-4"})})]}),m&&e.jsxs("button",{onClick:()=>m(s),className:"flex items-center justify-center gap-2 px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white text-xs font-medium rounded-lg transition-colors whitespace-nowrap",title:"إصدار فاتورة",children:[e.jsx(W,{className:"h-3.5 w-3.5"}),"إصدار فاتورة"]})]})})}}],[f,j,N,i,d,m]);return R({data:q,columns:v,getCoreRowModel:B(),getFilteredRowModel:P(),getSortedRowModel:M(),getPaginationRowModel:F(),onSortingChange:w,onColumnFiltersChange:C,onGlobalFilterChange:g,state:{sorting:y,columnFilters:k,globalFilter:r},initialState:{pagination:{pageSize:10}}}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx(A,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"العقود"}),e.jsxs(T,{onClick:b,className:"flex items-center gap-2 bg-[#58d2c8] hover:bg-[#4AB8B3]",children:[e.jsx(L,{className:"h-4 w-4"}),"إضافة عقد جديد"]})]})}),e.jsx(p,{children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"البحث في جميع العقود...",value:r,onChange:t=>g(t.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#58d2c8] focus:border-transparent"})]})})]}),u(H,"عقود مفتوحة","bg-green-50 dark:bg-green-900/10","border-green-200 dark:border-green-800"),u(U,"عقود مغلقة ولم يتم استلام الأصناف","bg-orange-50 dark:bg-orange-900/10","border-orange-200 dark:border-orange-800"),u(_,"عقود مغلقة","bg-blue-50 dark:bg-blue-900/10","border-blue-200 dark:border-blue-800"),l.length===0&&!V&&e.jsx(h,{children:e.jsxs(p,{className:"p-8 text-center",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"لا توجد عقود"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"لم يتم العثور على أي عقود في النظام"}),e.jsxs(T,{onClick:b,className:"bg-[#58d2c8] hover:bg-[#4AB8B3]",children:[e.jsx(L,{className:"h-4 w-4 ml-2"}),"إضافة عقد جديد"]})]})})]})}export{xe as C};
